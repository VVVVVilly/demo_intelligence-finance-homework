<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢åŠ¡æ™ºèƒ½å®¡æ ¸ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            opacity: 0; /* For page load animation */
            transition: opacity 0.5s ease-in-out;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navbar styles */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        .nav-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: bold; color: #667eea; }
        .nav-links { display: flex; gap: 20px; } /* Adjusted gap for more links */
        .nav-link { text-decoration: none; color: #333; font-weight: 500; padding: 10px 15px; border-radius: 25px; transition: all 0.3s ease; cursor: pointer; } /* Adjusted padding */
        .nav-link:hover, .nav-link.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; transform: translateY(-2px); }

        /* Main content & page styles */
        .main-content { margin-top: 80px; min-height: calc(100vh - 80px); padding-bottom: 40px;}
        .page { display: none; animation: fadeIn 0.5s ease-in-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Hero section styles */
        .hero { text-align: center; padding: 80px 0; color: white; }
        .hero h1 { font-size: 48px; margin-bottom: 20px; opacity: 0; animation: slideInDown 1s ease-out 0.5s forwards; }
        .hero p { font-size: 20px; margin-bottom: 40px; opacity: 0; animation: slideInUp 1s ease-out 0.7s forwards; }
        .cta-button { background: white; color: #667eea; padding: 15px 40px; border: none; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-decoration: none; }
        .cta-button:hover { background: #f0f0f0; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        @keyframes slideInDown { from { opacity: 0; transform: translateY(-50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }

        /* Data input module styles */
        .module-header { background: rgba(255, 255, 255, 0.95); padding: 30px 40px; border-radius: 20px; margin: 30px 0; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .module-header h2 { margin-bottom: 10px; color: #667eea; }
        .upload-area { background: rgba(255, 255, 255, 0.95); border: 3px dashed #667eea; border-radius: 20px; padding: 50px; text-align: center; margin: 20px 0 30px 0; cursor: pointer; transition: all 0.3s ease; }
        .upload-area:hover { border-color: #764ba2; background: rgba(255, 255, 255, 1); transform: scale(1.02); }
        .upload-icon { font-size: 48px; color: #667eea; margin-bottom: 15px; }
        .upload-area h3 { margin-bottom: 10px; }

        /* Processing visualization styles */
        .processing-visualization { background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 15px; margin: 30px 0; box-shadow: 0 5px 20px rgba(0,0,0,0.08); display: none; }
        .processing-visualization h4 { color: #667eea; margin-bottom: 15px; text-align: center; }
        .processing-step-visual { display: flex; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px; opacity: 0; transform: translateX(-20px); transition: opacity 0.5s ease, transform 0.5s ease; }
        .processing-step-visual.visible { opacity: 1; transform: translateX(0); }
        .processing-step-visual .icon { font-size: 24px; margin-right: 15px; color: #764ba2; width: 40px; text-align: center; }
        .processing-step-visual .text { font-size: 16px; }
        .processing-step-visual .status { margin-left: auto; font-style: italic; color: #555; }

        /* Progress bar styles */
        .progress-bar-container { margin: 25px 0; }
        .progress-bar { width: 100%; height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); width: 0%; transition: width 0.5s ease-in-out; }

        /* Results area and data table styles */
        .results-area { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; margin: 30px 0; display: none; }
        .results-area.show { display: block; animation: fadeIn 0.5s ease-in-out; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        .data-table th { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .account-link-simulation { color: #007bff; text-decoration: underline; cursor: pointer; font-weight: 500; }
        .account-link-simulation:hover { color: #0056b3; }

        /* Data flow & status panel styles */
        .data-flow { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .flow-item { background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; text-align: center; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.07); transition: transform 0.3s ease; }
        .flow-item:hover { transform: translateY(-5px); }
        .flow-item h4 { color: #667eea; margin-bottom: 8px; }
        .flow-item::after { content: 'â”'; position: absolute; right: -18px; top: 50%; transform: translateY(-50%); font-size: 28px; color: #667eea; opacity: 0.6; }
        .flow-item:last-child::after { display: none; }
        .status-panel { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; margin: 30px 0; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        .status-panel h3 { margin-bottom: 20px; color: #764ba2; text-align: center;}
        .status-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .status-item:last-child { border-bottom: none; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; background: #4CAF50; margin-right: 10px; flex-shrink: 0; }
        .status-indicator.warning { background: #FFC107; }
        .status-indicator.error { background: #F44336; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 24px; height: 24px; border-radius: 50%; border-left-color: #667eea; animation: spin 1s ease infinite; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Automated finding card styles - Refined */
        .automated-finding-card { background: #fff; border: 1px solid #e0e0e0; padding: 25px; border-radius: 12px; margin: 25px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .finding-header { display: flex; align-items: center; margin-bottom: 18px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .finding-header .icon { font-size: 28px; margin-right: 15px; }
        .finding-header .title { font-size: 1.3em; font-weight: 600; color: #333; }
        .finding-header .priority-tag { margin-left: auto; padding: 5px 12px; border-radius: 15px; font-size: 0.85em; font-weight: 500; color: #fff; }
        .priority-tag.high { background-color: #F44336; }
        .priority-tag.medium { background-color: #FF9800; }
        .priority-tag.low { background-color: #4CAF50; } /* Added for under-budget if needed */
        .finding-content { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .finding-section { margin-bottom: 10px; }
        .finding-section h6 { font-size: 1.0em; color: #667eea; margin-bottom: 8px; font-weight: 600; }
        .finding-section p, .finding-section ul { line-height: 1.7; color: #555; font-size: 0.95em; margin-bottom: 8px; }
        .finding-section ul { list-style-position: inside; padding-left: 5px; }
        .finding-section ul li { margin-bottom: 5px; }
        .key-data-highlight { background: rgba(102, 126, 234, 0.08); padding: 3px 6px; border-radius: 4px; font-weight: bold; color: #667eea; }
        .important-note { background: rgba(255, 152, 0, 0.08); padding: 3px 6px; border-radius: 4px; font-weight: bold; color: #FF9800; }
        .important-note.over { color: #F44336; background: rgba(244, 67, 54, 0.08);}
        .important-note.under { color: #FF9800; background: rgba(255, 152, 0, 0.08); }

        .finding-actions { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; display: flex; gap: 15px; flex-wrap: wrap; }
        .action-button-sim { background: #667eea; color: white; padding: 10px 18px; border: none; border-radius: 20px; font-size: 0.9em; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-decoration: none; }
        .action-button-sim:hover { background: #5a6fcf; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .action-button-sim.secondary { background: #f0f0f0; color: #555; }
        .action-button-sim.secondary:hover { background: #e0e0e0; }
        .action-button-sim.actioned {
            background: #d6d6d6;
            color: #777;
            cursor: default;
            pointer-events: none;
        }
         .action-button-sim.actioned:hover {
            background: #d6d6d6;
            transform: translateY(0);
            box-shadow: none;
        }


        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeInModal 0.3s ease-out;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background-color: #fefefe;
            margin: 8% auto;
            padding: 25px 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            position: relative;
            animation: slideInModal 0.4s ease-out;
        }
        @keyframes slideInModal { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-close-btn {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 32px;
            font-weight: bold;
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #555;
            text-decoration: none;
            cursor: pointer;
        }
        #modalTitle {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1.6em;
        }
        #modalBody {
            max-height: 60vh;
            overflow-y: auto;
            line-height: 1.6;
        }
        #modalBody table.modal-table { /* More specific selector */
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        #modalBody table.modal-table th, /* More specific selector */
        #modalBody table.modal-table td { /* More specific selector */
            border: 1px solid #ddd;
            padding: 10px 12px;
            text-align: left;
            font-size: 0.95em;
        }
        #modalBody table.modal-table th { /* More specific selector */
            background-color: #f4f6f8;
            color: #333;
            font-weight: 600;
        }
         #modalBody table.modal-table .total-row td { /* More specific selector */
            font-weight: bold;
            background-color: #f9f9f9;
        }
        #modalBody .log-entry { padding: 8px 0; border-bottom: 1px dashed #eee; }
        #modalBody .log-entry:last-child { border-bottom: none; }
        #modalBody .log-timestamp { font-size: 0.8em; color: #888; margin-right: 10px; }
        #modalBody .log-highlight, #modalBody .policy-keyword { color: #764ba2; font-weight: bold; }
        #modalBody .log-conclusion, #modalBody .policy-review-conclusion { margin-top:15px; padding:10px; background-color: #f0f8ff; border-left: 3px solid #667eea; font-style: italic; }
        #modalBody .risk-summary-section h5, #modalBody .policy-section h5, #modalBody .assignment-section h5 { color: #667eea; margin-top: 15px; margin-bottom: 8px; padding-bottom: 3px; border-bottom: 1px solid #eee; }
         #modalBody .risk-summary-section ul, #modalBody .policy-section ul, #modalBody .assignment-section ul { list-style-type: none; margin-left: 0; padding-left: 0px; }
        #modalBody .risk-summary-section ul li, #modalBody .policy-section ul li { margin-bottom: 5px; margin-left:20px; list-style-type:disc;}
         #modalBody .assignment-section ul li {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius:5px;
            display:flex;
            justify-content: space-between;
            align-items: center;
        }
        #modalBody .policy-excerpt { background-color: #f9f9f9; border: 1px solid #e7e7e7; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 0.9em; }
        #modalBody .system-check { background-color: #fff8e1; border: 1px solid #ffe082; padding: 8px; margin-top: 5px; border-radius: 4px; font-size: 0.85em; }
         #modalBody .system-check strong { color: #FF9800; }
         .send-email-btn {
            background-color: #28a745;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            text-decoration: none; /* For <a> tags styled as buttons */
        }
        .send-email-btn:hover {
            background-color: #218838;
        }
         #modalBody .assignment-description {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        /* Budget Control Page Specific Styles */
        .budget-input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .budget-input-box { background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.07); }
        .budget-input-box h4 { color: #667eea; margin-bottom: 15px; text-align: center; }
        .budget-input-box .api-status { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f0f0f0; border-radius: 8px; margin-bottom: 15px; }
        .budget-input-box .api-status span:last-child { font-weight: bold; color: #4CAF50; }
        .budget-input-box .excel-select-area { border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; margin-bottom: 15px; cursor: pointer; }
        .budget-input-box .excel-select-area:hover { border-color: #667eea; }
        .budget-input-box .action-button-sim { display: block; width: 100%; text-align: center; }

        .budget-processing-status { background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.07); }
        .budget-processing-status h4 { color: #667eea; margin-bottom: 15px; text-align: center; }
        .budget-processing-status .progress-bar-container { margin: 15px 0 0 0; }
        .budget-processing-status .status-item { padding: 8px 0; font-size: 0.95em; }
        .budget-processing-status .status-item span:first-child { color: #555; }
        .budget-processing-status .status-item span:last-child { float: right; font-weight: bold; color: #764ba2; }

        .budget-dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .budget-chart-container { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .budget-chart-container h5 { color: #667eea; margin-bottom: 15px; text-align: center; }
        .budget-execution-chart .bar-group { margin-bottom: 10px; display: flex; align-items: center; }
        .budget-execution-chart .bar-label { width: 80px; font-size: 0.85em; color: #555; white-space: nowrap; }
        .budget-execution-chart .bar-wrapper { flex-grow: 1; background: #e0e0e0; border-radius: 5px; height: 20px; overflow: hidden; position: relative; }
        .budget-execution-chart .bar { background: linear-gradient(135deg, #667eea, #764ba2); height: 100%; border-radius: 5px 0 0 5px; transition: width 0.5s ease; text-align: right; padding-right: 5px; color: white; font-size: 0.8em; line-height: 20px;}
        .budget-execution-chart .bar.over-budget { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .budget-execution-chart .percentage-label { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); color: white; font-size: 0.8em; font-weight: bold; }


        .budget-variance-alerts .alert-item { background: #fff3cd; border-left: 5px solid #ffeeba; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.2s ease; }
        .budget-variance-alerts .alert-item:hover { transform: translateY(-2px); }
        .budget-variance-alerts .alert-item.high-alert { background: #f8d7da; border-left-color: #f5c6cb;}
        .budget-variance-alerts .alert-item h6 { margin-bottom: 5px; color: #856404; }
        .budget-variance-alerts .alert-item.high-alert h6 { color: #721c24; }
        .budget-variance-alerts .alert-item p { font-size: 0.9em; color: #555; }

        .budget-stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .budget-stat-card { background: #fff; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .budget-stat-card .value { font-size: 2em; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .budget-stat-card .value.red { color: #F44336; }
        .budget-stat-card .value.orange { color: #FF9800; }
        .budget-stat-card .label { font-size: 0.9em; color: #777; }
        .budget-stat-card.clickable:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); cursor:pointer; }


        .trend-chart-placeholder { height: 200px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #aaa; font-style: italic; margin-top:10px; background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22100%25%22%20height%3D%22100%25%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cdefs%3E%3Cpattern%20id%3D%22smallGrid%22%20width%3D%2210%22%20height%3D%2210%22%20patternUnits%3D%22userSpaceOnUse%22%3E%3Cpath%20d%3D%22M%2010%200%20L%200%200%200%2010%22%20fill%3D%22none%22%20stroke%3D%22%23e0e0e0%22%20stroke-width%3D%220.5%22/%3E%3C/pattern%3E%3Cpattern%20id%3D%22grid%22%20width%3D%2250%22%20height%3D%2250%22%20patternUnits%3D%22userSpaceOnUse%22%3E%3Crect%20width%3D%2250%22%20height%3D%2250%22%20fill%3D%22url(%23smallGrid)%22/%3E%3Cpath%20d%3D%22M%2050%200%20L%200%200%200%2050%22%20fill%3D%22none%22%20stroke%3D%22%23cccccc%22%20stroke-width%3D%221%22/%3E%3C/pattern%3E%3C/defs%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22url(%23grid)%22%20/%3E%3Cpolyline%20fill%3D%22none%22%20stroke%3D%22%23667eea%22%20stroke-width%3D%222%22%20points%3D%2210,150%2050,120%20100,140%20150,90%20200,110%20250,80%22%20/%3E%3Cpolyline%20fill%3D%22none%22%20stroke%3D%22%23FF9800%22%20stroke-width%3D%222%22%20stroke-dasharray%3D%224%22%20points%3D%22250,80%20280,70%20310,90%22%20/%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20text-anchor%3D%22middle%22%20fill%3D%22%23aaa%22%20font-size%3D%2214%22%20font-style%3D%22italic%22%3Eé¢„ç®—è¶‹åŠ¿é¢„æµ‹å›¾ (ç¤ºæ„)%3C/text%3E%3C/svg%3E'); background-size: cover; background-repeat: no-repeat; background-position: center;}

        /* International Page Specific Styles */
        .config-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.07);
        }
        .config-section h4 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .config-section label {
            font-weight: 500;
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .config-section select, .config-section input[type="text"], .config-section input[type="number"] {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .config-section .info-display p {
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .config-section .info-display p strong {
            color: #764ba2;
        }
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .config-subsection {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .config-subsection h5 {
            color: #764ba2;
            margin-bottom: 10px;
        }
        #modalBody .form-group { margin-bottom: 15px; }
        #modalBody .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555;}
        #modalBody .form-group select, #modalBody .form-group input, #modalBody .form-group textarea { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        #modalBody .form-group textarea { min-height: 80px; }


        @media (max-width: 768px) {
            .nav-links { display: none; } /* Keep this if hamburger menu not implemented */
            .hero h1 { font-size: 36px; } .hero p { font-size: 18px; }
            .cta-button { font-size: 16px; padding: 12px 30px;}
            .data-flow { grid-template-columns: 1fr; } .flow-item::after { display: none; }
            .module-header { padding: 20px; } .upload-area { padding: 30px; }
            .finding-content { grid-template-columns: 1fr; }
            .modal-content { width: 90%; margin: 10% auto; }
            #modalTitle { font-size: 1.4em; }
            .budget-input-grid { grid-template-columns: 1fr; }
            .config-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="navbar"> <div class="container"> <div class="nav-content"> <div class="logo">è´¢åŠ¡æ™ºèƒ½å®¡æ ¸ç³»ç»Ÿ</div> <div class="nav-links"> <a class="nav-link active" data-page="home">é¦–é¡µ</a> <a class="nav-link" data-page="data-input">æŠ¥è¡¨å®¡æ ¸</a> <a class="nav-link" data-page="budget-control">é¢„ç®—æ§åˆ¶</a> <a class="nav-link" data-page="international-version">å›½é™…ç‰ˆæœ¬</a> </div> </div> </div> </nav>

    <main class="main-content">
        <div class="page active" id="home"> <div class="container"> <div class="hero"> <h1>æ™ºèƒ½è´¢åŠ¡æŠ¥è¡¨å¹³å°</h1> <p>åŸºäºOCRä¸å¤§æ¨¡å‹çš„æ–°ä¸€ä»£è´¢åŠ¡æ•°å­—åŒ–è§£å†³æ–¹æ¡ˆ</p> <button class="cta-button" onclick="showPage('data-input')">å¼€å§‹ä½“éªŒæ™ºèƒ½è§£æ</button> </div> </div> </div>
        <div class="page" id="data-input">
            <div class="container">
                <div class="module-header"> <h2>æ•°æ®è¾“å…¥ä¸å¤„ç†æµç¨‹</h2> <p>ä¸Šä¼ æ‚¨çš„è´¢åŠ¡æŠ¥è¡¨ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å®Œæˆè§£æã€ç»“æ„åŒ–å’Œæ·±åº¦æ™ºèƒ½åˆ†æã€‚</p> </div>
                <div class="upload-area" id="uploadArea"> <div class="upload-icon">ğŸ“</div> <h3>ç‚¹å‡»ä¸Šä¼ è´¢åŠ¡æŠ¥è¡¨</h3> <p>æ”¯æŒ PDF, JPG, PNG ç­‰æ‰«æä»¶æˆ–ç”µå­æ–‡æ¡£</p> </div>
                <div class="progress-bar-container" id="progressBarContainer" style="display: none;"> <div class="progress-bar"> <div class="progress-fill" id="overallProgress"></div> </div> </div>
                <div class="processing-visualization" id="processingVisualization"><h4>å®æ—¶å¤„ç†è¿›åº¦</h4> <div id="uploadVisual" class="processing-step-visual"> <div class="icon">ğŸ“¤</div> <div class="text">æ–‡ä»¶ä¸Šä¼ ä¸­...</div> <div class="status" id="uploadFileName">è´¢åŠ¡æŠ¥è¡¨_å¹´åº¦.pdf</div> </div> <div id="ocrVisual" class="processing-step-visual"> <div class="icon">ğŸ”</div> <div class="text">æ™ºèƒ½OCRè¯†åˆ«ï¼šæå–æ–‡æœ¬ä¸æ•°æ®...</div> <div class="status">è¿›è¡Œä¸­</div> </div> <div id="structureVisual" class="processing-step-visual"> <div class="icon">ğŸ“Š</div> <div class="text">è¡¨æ ¼ç»“æ„è¿˜åŸä¸é™„æ³¨å†…å®¹è§£æ...</div> <div class="status">è¿›è¡Œä¸­</div> </div> <div id="outputVisual" class="processing-step-visual"> <div class="icon">ğŸ“„</div> <div class="text">åˆæ­¥ç»“æ„åŒ–æ•°æ®ç”Ÿæˆ...</div> <div class="status">è¿›è¡Œä¸­</div> </div> </div>
                <div class="results-area" id="ocrResultsArea"> <h3>åˆæ­¥è§£æç»“æœ</h3> <div id="ocrOutput"></div> </div>
                <div id="modelingSection" style="display:none;">
                     <div class="module-header" style="margin-top: 50px;"> <h2>æ•°æ®ç»“æ„åŒ–ä¸æ™ºèƒ½åˆ†æ</h2> <p>å¯¹è§£ææ•°æ®è¿›è¡Œæ¸…æ´—ã€æ ¡éªŒã€å»ºæ¨¡ï¼Œå¹¶ç»“åˆå¤§æ¨¡å‹è¿›è¡Œæ·±åº¦åˆ†æä¸æ´å¯Ÿã€‚</p> </div>
                    <div class="data-flow"> <div class="flow-item"> <h4>æ•°æ®æ¸…æ´—</h4> <p>è§„èŒƒæ ¼å¼,å»å†—ä½™</p> </div> <div class="flow-item"> <h4>å®Œæ•´æ€§ä¸å¹³è¡¡æ ¡éªŒ</h4> <p>å…³é”®å­—æ®µ,å‹¾ç¨½å…³ç³»</p> </div> <div class="flow-item"> <h4>ç§‘ç›®æ ‡å‡†åŒ–æ˜ å°„</h4> <p>ç»Ÿä¸€ä¼šè®¡å‡†åˆ™</p> </div> <div class="flow-item"> <h4>AIé©±åŠ¨æ·±åº¦åˆ†æ</h4> <p>é£é™©è¯†åˆ«,æ™ºèƒ½è§£é‡Š</p> </div> </div>
                    <div class="status-panel" id="modelingStatus"> <h3>åŸºç¡€æ ¡éªŒä¸å¤„ç†çŠ¶æ€</h3> <div class="status-item"> <span><span class="status-indicator"></span>èµ„äº§è´Ÿå€ºè¡¨å¹³è¡¡æ ¡éªŒ</span> <span id="balanceSheetStatus">å¤„ç†ä¸­...</span> </div> <div class="status-item"> <span><span class="status-indicator warning"></span>åˆ©æ¶¦è¡¨ä¸»è¦å‹¾ç¨½å…³ç³»</span> <span id="incomeStatementStatus">å¤„ç†ä¸­...</span> </div> <div class="status-item"> <span><span class="status-indicator"></span>ç°é‡‘æµé‡è¡¨æ•°æ®æ ¸å¯¹</span> <span id="cashFlowStatus">å¤„ç†ä¸­...</span> </div> <div class="status-item"> <span><span class="status-indicator"></span>æ•°æ®è´¨é‡ç»¼åˆè¯„ä¼°</span> <span id="dataQualityStatus">è¯„ä¼°ä¸­...</span> </div> </div>
                    <div class="results-area" id="modelingResultsArea" style="padding-bottom: 50px;"> <h3>æ·±åº¦æ™ºèƒ½åˆ†æä¸å®¡è®¡æ´å¯Ÿ</h3> <div id="modelingOutput"></div> </div>
                </div>
            </div>
        </div>
        <div class="page" id="budget-control">
            <div class="container">
                <div class="module-header">
                    <h2>é¢„ç®—æ§åˆ¶å®¡æ ¸</h2>
                    <p>é›†æˆä¼ä¸šé¢„ç®—æ•°æ®ï¼Œå¯¹æ¯”å®é™…å‘ç”Ÿï¼Œæ™ºèƒ½åˆ†æåå·®å¹¶è¾…åŠ©å†³ç­–ã€‚</p>
                </div>

                <div class="budget-input-grid">
                    <div class="budget-input-box">
                        <h4>é¢„ç®—ç®¡ç†ç³»ç»Ÿå¯¹æ¥</h4>
                        <div class="api-status"><span>APIè¿æ¥çŠ¶æ€ï¼š</span><span id="budgetApiStatus">å·²è¿æ¥</span></div>
                        <button class="action-button-sim" id="syncBudgetSystemBtn">åŒæ­¥æœ€æ–°é¢„ç®—æ•°æ®</button>
                    </div>
                    <div class="budget-input-box">
                        <h4>é¢„ç®—è¡¨æ ¼å¯¼å…¥</h4>
                        <div class="excel-select-area" id="budgetExcelUpload">ç‚¹å‡»é€‰æ‹©Excelæ–‡ä»¶</div>
                        <button class="action-button-sim" id="importBudgetExcelBtn">å¯¼å…¥é¢„ç®—è¡¨</button>
                    </div>
                </div>

                <div class="budget-processing-status" id="budgetProcessingStatus" style="display: none;">
                    <h4>æ•°æ®å¤„ç†çŠ¶æ€</h4>
                    <p id="budgetProcessingText">æ­£åœ¨å¤„ç†é¢„ç®—æ•°æ®...</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar"><div class="progress-fill" id="budgetProgressFill"></div></div>
                    </div>
                    <div class="status-item"><span>éƒ¨é—¨é¢„ç®—æ•°æ®ï¼š</span><span id="deptBudgetStatus">ç­‰å¾…å¯¼å…¥</span></div>
                    <div class="status-item"><span>å®é™…å‘ç”Ÿæ•°ï¼š</span><span id="actualsSyncStatus">ç­‰å¾…åŒæ­¥</span></div>
                </div>

                <div id="budgetDashboard" style="display:none;">
                    <div class="module-header" style="margin-top:40px;">
                        <h2>é¢„ç®—æ‰§è¡Œä¸åˆ†æçœ‹æ¿</h2>
                    </div>
                    <div class="budget-dashboard-grid">
                        <div class="budget-chart-container">
                            <h5>å„éƒ¨é—¨é¢„ç®—æ‰§è¡Œç‡</h5>
                            <div class="budget-execution-chart" id="deptExecutionChart">
                                 </div>
                        </div>
                        <div class="budget-chart-container">
                            <h5>é¢„ç®—åå·®è­¦å‘Š</h5>
                            <div class="budget-variance-alerts" id="varianceAlertsPanel">
                                 </div>
                        </div>
                    </div>
                    <div class="budget-stats-container" id="budgetStatsCards">
                         </div>
                </div>

                <div id="budgetDetailedAnalysisSection" class="results-area" style="margin-top: 30px;">
                   <div id="budgetAnalysisOutput">
                         </div>
                </div>

            </div>
        </div>

        <div class="page" id="international-version">
            <div class="container">
                <div class="module-header">
                    <h2>å›½é™…åŒ–è´¢åŠ¡é€‚é…ä¸å®¡æ ¸</h2>
                    <p>æ”¯æŒå¤šæ³•äººã€å¤šè´¦å¥—ã€å¤šå‡†åˆ™ã€å¤šå¸ç§çš„å¤æ‚è´¢åŠ¡ç¯å¢ƒï¼Œå®ç°é›†å›¢ç»Ÿä¸€åŒ–æ™ºèƒ½å®¡æ ¸ã€‚</p>
                </div>

                <div class="config-section">
                    <h4>å®ä½“é€‰æ‹©ä¸åŸºç¡€é…ç½® (Entity Selection & Basic Configuration)</h4>
                    <label for="entitySelect">é€‰æ‹©æ“ä½œå®ä½“ (Select Entity):</label>
                    <select id="entitySelect">
                        <option value="entityA">å­å…¬å¸A (ä¸­å›½, CAS, CNY)</option>
                        <option value="entityB">Subsidiary B (USA, IFRS, USD)</option>
                        <option value="entityC">Branch C (Europe, IFRS, EUR)</option>
                    </select>
                    <div class="info-display" id="entityBasicInfoDisplay" style="margin-top:15px; padding:10px; background-color:#f8f9fa; border-radius:8px;">
                        <p><strong>å½“å‰å®ä½“:</strong> <span id="dispEntityName">å­å…¬å¸A (ä¸­å›½, CAS, CNY)</span></p>
                        <p><strong>ä¼šè®¡å‡†åˆ™:</strong> <span id="dispAccountingStandard">ä¸­å›½ä¼šè®¡å‡†åˆ™ (CAS)</span></p>
                        <p><strong>æŠ¥å‘Šå¸ç§:</strong> <span id="dispReportingCurrency">äººæ°‘å¸ (CNY)</span></p>
                    </div>
                </div>

                <div class="config-grid">
                    <div class="config-section">
                        <h4>â‘  ç§‘ç›®ä½“ç³»é€‚é… (Chart of Accounts Adaptation)</h4>
                        <p>æ ¹æ®å•ä½æ ‡è¯†é€‰å–å¯¹åº”è§„åˆ™ä½“ç³»ï¼Œè‡ªåŠ¨è½¬æ¢åŸå§‹ç§‘ç›®ä¸ºé›†å›¢ç»Ÿä¸€å£å¾„ç§‘ç›®ã€‚</p>
                        <button class="action-button-sim" id="viewCoaMappingBtn" style="margin-top:10px;">æŸ¥çœ‹ç§‘ç›®æ˜ å°„è¡¨ç¤ºä¾‹</button>
                        <div class="config-subsection" style="margin-top:15px;">
                            <h5>å•ä½ç‰¹å®šå®¡æ ¸è§„åˆ™ (Entity-Specific Audit Rules)</h5>
                            <p id="entitySpecificRulesText">å­å…¬å¸A: å¯ç”¨ä¸­å›½ç‰¹è‰²å¢å€¼ç¨ç›¸å…³å®¡æ ¸è§„åˆ™ï¼Œå…³æ³¨ç ”å‘è´¹ç”¨åŠ è®¡æ‰£é™¤åˆè§„æ€§ã€‚</p>
                        </div>
                    </div>

                    <div class="config-section">
                        <h4>â‘¡ å¤šå‡†åˆ™æ”¯æŒ (Multi-Standard Support)</h4>
                        <p>æŒ‰å•ä½é…ç½®æ‰§è¡Œä¸åŒä¼šè®¡å‡†åˆ™è§„åˆ™é›† (CAS, IFRSç­‰)ã€‚</p>
                        <div class="info-display" style="margin-top:10px;">
                            <p><strong>å½“å‰é€‰ç”¨å‡†åˆ™åº“:</strong> <span id="selectedStandardLib">ä¸­å›½ä¼šè®¡å‡†åˆ™ (CAS) è§„åˆ™é›†</span></p>
                        </div>
                        <div class="config-subsection" style="margin-top:15px;">
                            <h5>å‡†åˆ™ç‰¹å®šå®¡æ ¸ç‚¹ç¤ºä¾‹ (Standard-Specific Audit Points)</h5>
                            <ul id="standardSpecificPointsList" style="font-size:0.9em; list-style-type: disc; padding-left:20px;">
                                <li>å›ºå®šèµ„äº§æŠ˜æ—§å¹´é™ä¸æ®‹å€¼ç‡ç¬¦åˆCASè§„å®šã€‚</li>
                                <li>æ”¶å…¥ç¡®è®¤æ»¡è¶³CASæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯ç‰¹å®šè¡Œä¸šçš„æ”¶å…¥ç¡®è®¤æ–¹æ³•ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>â‘¢ å¤šå¸ç§å¤„ç† (Multi-Currency Handling)</h4>
                    <p>è‡ªåŠ¨è¯†åˆ«æŠ¥è¡¨å¸ç§ï¼Œæ”¯æŒæ±‡ç‡æŠ˜ç®—ï¼Œå®ç°ç»Ÿä¸€å¸ç§åˆ†æä¸å¯¹æ¯”ã€‚</p>
                    <div class="config-grid">
                        <div class="config-subsection">
                            <h5>å¸ç§ä¿¡æ¯</h5>
                            <p><strong>åŸå§‹æŠ¥è¡¨å¸ç§:</strong> <span id="sourceCurrencyDisplay">äººæ°‘å¸ (CNY)</span></p>
                            <p><strong>é›†å›¢ç»Ÿä¸€åˆ†æå¸ç§ (æ¨¡æ‹Ÿ):</strong> äººæ°‘å¸ (CNY)</p>
                        </div>
                        <div class="config-subsection" id="currencyConversionSection">
                            <h5>æ¨¡æ‹Ÿå¸ç§æŠ˜ç®— (Simulate Conversion)</h5>
                            <label for="exchangeRateInput">è¾“å…¥ <span id="inputRateFromCurrency">USD</span> åˆ° <span id="inputRateToCurrency">CNY</span> æ±‡ç‡:</label>
                            <input type="number" id="exchangeRateInput" value="7.10" step="0.01" style="width: auto; display: inline-block; margin-right:10px; max-width:100px;" disabled>
                            <button class="action-button-sim secondary" id="simulateConversionBtn" style="padding: 8px 12px;" disabled>æŠ˜ç®—</button>
                            <div id="conversionResultDisplay" style="margin-top:10px; font-size:0.9em;">
                                </div>
                        </div>
                    </div>
                     <p style="margin-top:15px; font-size:0.9em;"><strong>å¯¹æ¯”æ¨¡å¼:</strong> ç³»ç»Ÿæ”¯æŒåœ¨å®¡æ ¸æ—¶é€‰æ‹©â€œåŸå¸å¯¹æ¯”â€æˆ–â€œæŠ˜ç®—åå¯¹æ¯”â€æ¨¡å¼ï¼Œä»¥é€‚åº”ä¸åŒåˆ†æéœ€æ±‚ã€‚</p>
                </div>

                <div class="config-section">
                    <h4>â‘£ å‚æ•°åŒ–é…ç½®ä¸­å¿ƒ (Parameterized Configuration Center)</h4>
                    <p>é€šè¿‡å¯è§†åŒ–ç•Œé¢ä¸ºæ¯ä¸ªå•ä½ç‹¬ç«‹è®¾ç½®å®¡æ ¸å‚æ•°ï¼Œå®ç°çµæ´»æ¥å…¥ä¸ç®¡ç†ã€‚</p>
                    <div style="margin-top:15px;">
                        <button class="action-button-sim" id="manageEntityConfigBtn">ç®¡ç†å®ä½“é…ç½® (æ¨¡æ‹Ÿ)</button>
                        <button class="action-button-sim secondary" id="newEntityWizardBtn" style="margin-left:10px;">æ–°å¢å•ä½å‘å¯¼ (æ¨¡æ‹Ÿ)</button>
                    </div>
                </div>
            </div>
        </div>


    </main>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-btn" id="modalCloseBtn">&times;</span>
            <h3 id="modalTitle">è¯¦ç»†ä¿¡æ¯</h3>
            <div id="modalBody">
            </div>
        </div>
    </div>

    <script>
        // --- Page Navigation & Basic Demo Control (mostly unchanged) ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (activeLink) activeLink.classList.add('active');

            if (pageId === 'data-input') {
                // resetDataInputDemo(); // Potentially call if needed
            } else if (pageId === 'budget-control') {
                resetBudgetControlDemo();
            } else if (pageId === 'international-version') {
                resetInternationalVersionDemo(); // Initialize or reset the new page
                initializeInternationalPage();
            } else if (pageId === 'home') {
                 resetDataInputDemo();
                 resetBudgetControlDemo();
                 resetInternationalVersionDemo();
            }
        }
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => { e.preventDefault(); const pageId = link.getAttribute('data-page'); showPage(pageId); });
        });

        const uploadArea = document.getElementById('uploadArea');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const overallProgress = document.getElementById('overallProgress');
        const processingVisualization = document.getElementById('processingVisualization');
        const uploadVisual = document.getElementById('uploadVisual');
        const ocrVisual = document.getElementById('ocrVisual');
        const structureVisual = document.getElementById('structureVisual');
        const outputVisual = document.getElementById('outputVisual');
        const ocrResultsArea = document.getElementById('ocrResultsArea');
        const ocrOutput = document.getElementById('ocrOutput');
        const modelingSection = document.getElementById('modelingSection');
        const modelingStatus = document.getElementById('modelingStatus');
        const modelingResultsArea = document.getElementById('modelingResultsArea');
        const modelingOutput = document.getElementById('modelingOutput');
        let demoInProgress = false;

        function resetDataInputDemo() {
            demoInProgress = false;
            if(uploadArea) uploadArea.style.display = 'block';
            if(progressBarContainer) progressBarContainer.style.display = 'none';
            if(overallProgress) overallProgress.style.width = '0%';
            if(processingVisualization) processingVisualization.style.display = 'none';
            [uploadVisual, ocrVisual, structureVisual, outputVisual].forEach(el => {
                if (!el) return;
                el.classList.remove('visible');
                if (el.querySelector('.status')) el.querySelector('.status').textContent = 'ç­‰å¾…ä¸­';
            });
            if (uploadVisual && uploadVisual.querySelector('.status')) uploadVisual.querySelector('.status').textContent = 'è´¢åŠ¡æŠ¥è¡¨_å¹´åº¦.pdf';
            if (ocrVisual && ocrVisual.querySelector('.status')) ocrVisual.querySelector('.status').textContent = 'è¿›è¡Œä¸­';
            if (structureVisual && structureVisual.querySelector('.status')) structureVisual.querySelector('.status').textContent = 'è¿›è¡Œä¸­';
            if (outputVisual && outputVisual.querySelector('.status')) outputVisual.querySelector('.status').textContent = 'è¿›è¡Œä¸­';
            if(ocrResultsArea) ocrResultsArea.classList.remove('show');
            if(ocrOutput) ocrOutput.innerHTML = '';
            if(modelingSection) modelingSection.style.display = 'none';
            ['balanceSheetStatus', 'incomeStatementStatus', 'cashFlowStatus', 'dataQualityStatus'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = id === 'dataQualityStatus' ? 'è¯„ä¼°ä¸­...' : 'å¤„ç†ä¸­...';
                    const indicator = el.previousElementSibling.querySelector('.status-indicator');
                    if (indicator) indicator.className = `status-indicator ${id === 'incomeStatementStatus' ? 'warning' : ''}`;
                }
            });
            if(modelingResultsArea) modelingResultsArea.classList.remove('show');
            if(modelingOutput) modelingOutput.innerHTML = '';
        }

        if(uploadArea) uploadArea.addEventListener('click', () => { if (!demoInProgress) startDataInputProcess(); });

        function updateVisualStep(element, text, statusText = "å®Œæˆ", delay = 0) {
            return new Promise(resolve => {
                setTimeout(() => {
                    if (!element) { resolve(); return; }
                    element.classList.add('visible');
                    if (text && element.querySelector('.text')) element.querySelector('.text').textContent = text;
                    if (element.querySelector('.status')) {
                         element.querySelector('.status').innerHTML = statusText.includes("è¿›è¡Œä¸­") || statusText.includes("ç­‰å¾…ä¸­") || statusText.includes(".pdf") ? statusText : `<span style="color: #28a745; font-weight: bold;">${statusText} âœ“</span>`;
                    }
                    resolve();
                }, delay);
            });
        }

        // --- Modal Control Functions ---
        const detailModal = document.getElementById('detailModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalCloseBtn = document.getElementById('modalCloseBtn');

        if(modalCloseBtn) modalCloseBtn.onclick = () => closeModal();
        window.onclick = (event) => {
            if (event.target == detailModal) {
                closeModal();
            }
        };
        function openModal(title, contentHtml, callback) {
            if (!detailModal || !modalTitle || !modalBody) return;
            modalTitle.textContent = title;
            modalBody.innerHTML = contentHtml;
            detailModal.style.display = 'block';
            if (callback && typeof callback === 'function') {
                callback(); // Execute callback after modal content is loaded
            }
        }
        function closeModal() {
            if (!detailModal) return;
            detailModal.style.display = 'none';
            if(modalTitle) modalTitle.textContent = '';
            if(modalBody) modalBody.innerHTML = '';
        }

        // --- Mock Data and Detail View Generators (Original) ---
        const mockFinancialData = {
            "è´§å¸èµ„é‡‘": { total: 12345678.90, breakdown: [{ item: "åº“å­˜ç°é‡‘", amount: 50000.00 }, { item: "é“¶è¡Œå­˜æ¬¾ - ä¸­å›½å·¥å•†é“¶è¡Œ Aæ”¯è¡Œ", account: "xxx-1234", amount: 8250000.00 }, { item: "é“¶è¡Œå­˜æ¬¾ - ä¸­å›½å»ºè®¾é“¶è¡Œ Bæ”¯è¡Œ", account: "yyy-5678", amount: 3045678.90 }, { item: "å…¶ä»–è´§å¸èµ„é‡‘ - æ”¯ä»˜å®ä½™é¢", amount: 1000000.00 }] },
            "åº”æ”¶ç¥¨æ®åŠåº”æ”¶è´¦æ¬¾": { total: 8765432.10, breakdown: [{ type: "åº”æ”¶ç¥¨æ®", customer: "å®¢æˆ·Aå…¬å¸", dueDate: "2025-07-15", amount: 2000000.00 }, { type: "åº”æ”¶è´¦æ¬¾", customer: "å®¢æˆ·Bå…¬å¸ (è´¦é¾„1-3ä¸ªæœˆ)", amount: 3500000.00 }, { type: "åº”æ”¶è´¦æ¬¾", customer: "å®¢æˆ·Cå…¬å¸ (è´¦é¾„3-6ä¸ªæœˆ)", amount: 1265432.10 }, { type: "åº”æ”¶è´¦æ¬¾", customer: "å®¢æˆ·Då…¬å¸ (è´¦é¾„1å¹´ä»¥ä¸Šï¼Œå·²è®¡æåè´¦)", amount: 2000000.00 }] },
            "å­˜è´§": { total: 25430120.50, breakdown: [{ category: "åŸææ–™ - Xå‹ææ–™", quantity: "500 å¨", unitCost: "Â¥10,000/å¨", value: 5000000.00 }, { category: "åœ¨äº§å“ - Yå‹åŠæˆå“", batch: "202505A", progress: "60%", value: 8430120.50 }, { category: "äº§æˆå“ - Zå‹äº§å“", quantity: "1000 ä»¶", unitCost: "Â¥12,000/ä»¶", value: 12000000.00 }] },
            "å›ºå®šèµ„äº§å‡€é¢": { total: 45678901.23, note: "ä¸»è¦åŒ…æ‹¬ç”Ÿäº§è®¾å¤‡ã€åŠå…¬æ¥¼ç­‰ï¼Œæœ¬æœŸè®¡ææŠ˜æ—§ Â¥2,500,000ã€‚" },
            "è¥ä¸šæ”¶å…¥": { total: 150321678.00, note: "ä¸»è¥ä¸šåŠ¡æ”¶å…¥å æ¯”95%ï¼Œå…¶ä»–ä¸šåŠ¡æ”¶å…¥å æ¯”5%ã€‚" },
            "è¥ä¸šåˆ©æ¶¦": { total: 5120300.00 },
            "å‡€åˆ©æ¶¦": { total: 3550800.00 }
        };

        function generateAccountDetailHtml(accountName) {
            const data = mockFinancialData[accountName];
            if (!data) return "<p>æš‚æ— è¯¥ç§‘ç›®çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>";
            let html = `<h4>${accountName} - æ˜ç»† (æ¨¡æ‹Ÿæ•°æ®)</h4><p><strong>æ€»é‡‘é¢: ${data.total ? data.total.toLocaleString('en-US', { style: 'currency', currency: 'CNY' }) : 'N/A'}</strong></p>`;
            if (data.note) html += `<p>${data.note}</p>`;
            if (data.breakdown && data.breakdown.length > 0) {
                html += `<table class="modal-table"><thead><tr>`;
                const headers = Object.keys(data.breakdown[0]);
                headers.forEach(header => html += `<th>${header.charAt(0).toUpperCase() + header.slice(1)}</th>`);
                html += `</tr></thead><tbody>`;
                data.breakdown.forEach(item => {
                    html += `<tr>`;
                    headers.forEach(header => {
                        let value = item[header];
                        if (typeof value === 'number' && (header.toLowerCase().includes('amount') || header.toLowerCase().includes('value'))) value = value.toLocaleString('en-US', { style: 'currency', currency: 'CNY' });
                        html += `<td>${value !== undefined ? value : '-'}</td>`;
                    });
                    html += `</tr>`;
                });
                html += `</tbody></table>`;
            }
            return html;
        }

        function generateIncomeStatementDetailHtml() {
            const revenue = 150321678.00, costOfSales = 110500000.00, assetImpairmentLoss = 10000000.00, otherOperatingIncome = 500000.00, finalOperatingProfit = 5120300.00, financeCosts = 800000.00, nonOperatingIncome = 200000.00, nonOperatingExpenses = 100000.00, finalPBT = 4734400.00, incomeTaxRate = 0.25, finalIncomeTax = finalPBT * incomeTaxRate, finalNetProfit = 3550800.00;
            return `<h4>åˆ©æ¶¦è¡¨è¯¦ç»†ç§‘ç›® (æ¨¡æ‹Ÿæ•°æ®)</h4><p>æœŸé—´ï¼šæœ¬æŠ¥å‘ŠæœŸ</p><table class="modal-table"><thead><tr><th>é¡¹ç›®</th><th>é‡‘é¢ (CNY)</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>ä¸€ã€è¥ä¸šæ€»æ”¶å…¥</td><td>${revenue.toLocaleString()}</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;è¥ä¸šæ”¶å…¥</td><td>${revenue.toLocaleString()}</td><td></td></tr><tr><td>äºŒã€è¥ä¸šæ€»æˆæœ¬</td><td>${(costOfSales + 200000 + 8000000 + 7000000 + 5000000 + financeCosts + assetImpairmentLoss).toLocaleString()}</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;è¥ä¸šæˆæœ¬</td><td>${costOfSales.toLocaleString()}</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;ç¨é‡‘åŠé™„åŠ </td><td>${(200000).toLocaleString()}</td><td>æ¨¡æ‹Ÿ</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;é”€å”®è´¹ç”¨</td><td>${(8000000).toLocaleString()}</td><td>æ¨¡æ‹Ÿ</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;ç®¡ç†è´¹ç”¨</td><td>${(7000000).toLocaleString()}</td><td>æ¨¡æ‹Ÿ</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;ç ”å‘è´¹ç”¨</td><td>${(5000000).toLocaleString()}</td><td>æ¨¡æ‹Ÿ</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;è´¢åŠ¡è´¹ç”¨</td><td>${financeCosts.toLocaleString()}</td><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;å…¶ä¸­ï¼šåˆ©æ¯è´¹ç”¨</td><td>${(750000).toLocaleString()}</td><td>æ¨¡æ‹Ÿ</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;èµ„äº§å‡å€¼æŸå¤±</td><td><strong style="color:red;">${assetImpairmentLoss.toLocaleString()}</strong></td><td>ä¸»è¦ä¸ºå­˜è´§è·Œä»·å‡†å¤‡</td></tr><tr><td>åŠ ï¼šå…¶ä»–æ”¶ç›Š</td><td>${otherOperatingIncome.toLocaleString()}</td><td></td></tr><tr><td>ä¸‰ã€è¥ä¸šåˆ©æ¶¦</td><td><strong>${finalOperatingProfit.toLocaleString()}</strong></td><td></td></tr><tr><td>åŠ ï¼šè¥ä¸šå¤–æ”¶å…¥</td><td>${nonOperatingIncome.toLocaleString()}</td><td></td></tr><tr><td>å‡ï¼šè¥ä¸šå¤–æ”¯å‡º</td><td>${nonOperatingExpenses.toLocaleString()}</td><td></td></tr><tr><td>å››ã€åˆ©æ¶¦æ€»é¢</td><td><strong>${finalPBT.toLocaleString()}</strong></td><td></td></tr><tr><td>å‡ï¼šæ‰€å¾—ç¨è´¹ç”¨</td><td>${finalIncomeTax.toLocaleString()}</td><td>æŒ‰25%ç¨ç‡è®¡ç®—</td></tr><tr class="total-row"><td>äº”ã€å‡€åˆ©æ¶¦</td><td><strong>${finalNetProfit.toLocaleString()}</strong></td><td></td></tr></tbody></table>`;
        }

        function generateInventoryImpairmentDetailHtml() {
            const totalImpairment = 10000000.00;
            return `<h4>å­˜è´§è·Œä»·å‡†å¤‡è®¡æè¯¦æƒ… (æ¨¡æ‹Ÿæ•°æ®)</h4><p><strong>æœ¬æœŸè®¡ææ€»é¢: ${totalImpairment.toLocaleString('en-US', { style: 'currency', currency: 'CNY' })}</strong></p><p>æ ¹æ®ä¼ä¸šä¼šè®¡å‡†åˆ™åŠå…¬å¸å­˜è´§ç®¡ç†æ”¿ç­–ï¼Œå¯¹å¹´æœ«å­˜åœ¨å‡å€¼è¿¹è±¡çš„å­˜è´§è¿›è¡Œäº†å‡å€¼æµ‹è¯•ï¼Œè®¡ææ˜ç»†å¦‚ä¸‹ï¼š</p><table class="modal-table"><thead><tr><th>å­˜è´§ç±»åˆ«/åç§°</th><th>è´¦é¢æˆæœ¬ (CNY)</th><th>å¯å˜ç°å‡€å€¼ (CNY)</th><th>è®¡æè·Œä»·å‡†å¤‡ (CNY)</th><th>å‡å€¼åŸå› </th></tr></thead><tbody><tr><td>è¿‡æ—¶äº§æˆå“ - å‹å·RX-2021</td><td>8,000,000</td><td>2,000,000</td><td><strong style="color:red;">6,000,000</strong></td><td>æŠ€æœ¯è¿­ä»£ï¼Œå¸‚åœºéœ€æ±‚ä¸‹é™</td></tr><tr><td>æ®‹æ¬¡åŸææ–™ - æ‰¹å·MT-05B</td><td>5,500,000</td><td>1,500,000</td><td><strong style="color:red;">4,000,000</strong></td><td>è¿è¾“é€”ä¸­å—æ½®æŸå</td></tr><tr class="total-row"><td>åˆè®¡</td><td>13,500,000</td><td>3,500,000</td><td><strong>10,000,000</strong></td><td></td></tr></tbody></table><p style="margin-top:15px;"><strong>ç®¡ç†å±‚è¯´æ˜ï¼š</strong>ä¸Šè¿°å­˜è´§è·Œä»·å‡†å¤‡çš„è®¡æå·²ç»è¿‡å†…éƒ¨å®¡æ‰¹æµç¨‹ï¼Œå¹¶ç”±å®¡è®¡å§”å‘˜ä¼šå®¡é˜…ã€‚å…¬å¸å°†åŠ å¼ºå¯¹å­˜è´§åº“é¾„å’Œå¸‚åœºå˜åŒ–çš„ç›‘æ§ï¼Œä»¥ä¼˜åŒ–å­˜è´§ç®¡ç†ã€‚ </p>`;
        }

        function generateNotesCheckDetailHtml() {
            let ts = () => new Date().toLocaleTimeString();
            return `<div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æ­£åœ¨å¯åŠ¨é™„æ³¨åŸæ–‡ä¸è´¢åŠ¡æ•°æ®äº¤å‰éªŒè¯ç¨‹åº...</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: ç›®æ ‡ï¼šæ ¸å®é™„æ³¨ä¸­æŠ«éœ²çš„â€œé‡å¤§æˆ–æœ‰è´Ÿå€ºâ€äº‹é¡¹ä¸èµ„äº§è´Ÿå€ºè¡¨é¡¹ç›®çš„å¯¹åº”å…³ç³»ã€‚</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: å®šä½é™„æ³¨ç« èŠ‚ï¼š<span class="log-highlight">æˆ–æœ‰äº‹é¡¹ (é™„æ³¨ X.Y.Z)</span>...</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æå–å…³é”®æ–‡æœ¬æ®µè½ 1: 'æœ¬å…¬å¸äºæŠ¥å‘ŠæœŸæœ«å­˜åœ¨ä¸€é¡¹å°šæœªäº†ç»“çš„é‡å¤§è¯‰è®¼æ¡ˆä»¶ã€‚åŸå‘ŠAå…¬å¸å°±åˆåŒçº çº·å‘æœ¬å…¬å¸ç´¢èµ”äººæ°‘å¸<span class="log-highlight">1,500ä¸‡å…ƒ</span>ã€‚æ ¹æ®å¤–éƒ¨å¾‹å¸ˆæ„è§ï¼Œæœ¬å…¬å¸è´¥è¯‰å¹¶éœ€è¦æ”¯ä»˜èµ”å¿çš„å¯èƒ½æ€§<span class="log-highlight">è¾ƒé«˜ï¼ˆä¼°è®¡ä¸º70%ï¼‰</span>ï¼Œä½†å…·ä½“é‡‘é¢å°šä¸èƒ½å®Œå…¨å¯é åœ°è®¡é‡ï¼Œé¢„è®¡æ½œåœ¨æŸå¤±èŒƒå›´åœ¨<span class="log-highlight">800ä¸‡å…ƒè‡³1,500ä¸‡å…ƒ</span>ä¹‹é—´ã€‚ç®¡ç†å±‚è®¤ä¸ºï¼Œé‰´äºæ¡ˆä»¶çš„å¤æ‚æ€§å’Œä¸ç¡®å®šæ€§ï¼Œç›®å‰ä¸å®œç¡®è®¤é¢„è®¡è´Ÿå€ºï¼Œä½†å·²ä½œä¸ºæˆ–æœ‰è´Ÿå€ºåœ¨é™„æ³¨ä¸­å……åˆ†æŠ«éœ²ã€‚'</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: AIè¯­ä¹‰åˆ†ææ¨¡å—å¤„ç†ä¸­...</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: è¯†åˆ«å…³é”®è¯ï¼š'é‡å¤§è¯‰è®¼', 'ç´¢èµ”', 'è´¥è¯‰å¯èƒ½æ€§è¾ƒé«˜', 'æ½œåœ¨æŸå¤±', 'æœªç¡®è®¤é¢„è®¡è´Ÿå€º', 'æˆ–æœ‰è´Ÿå€ºæŠ«éœ²'ã€‚</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: åˆæ­¥åˆ†ç±»ï¼šè¯¥äº‹é¡¹ç¬¦åˆã€Šä¼ä¸šä¼šè®¡å‡†åˆ™ç¬¬13å·â€”â€”æˆ–æœ‰äº‹é¡¹ã€‹ä¸­å…³äº<span class="log-highlight">æˆ–æœ‰è´Ÿå€º</span>çš„å®šä¹‰ï¼Œä¸”æ»¡è¶³ç‰¹å®šæ¡ä»¶ä¸‹åº”ç¡®è®¤<span class="log-highlight">é¢„è®¡è´Ÿå€º</span>çš„æ½œåœ¨å¯èƒ½ï¼ˆå¯èƒ½æ€§è¾ƒé«˜ï¼‰ã€‚</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æ­£åœ¨äº¤å‰æ¯”å¯¹èµ„äº§è´Ÿå€ºè¡¨ç§‘ç›®...</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æŸ¥è¯¢ç§‘ç›®ï¼š'é¢„è®¡è´Ÿå€º'... <span class="log-highlight">ç»“æœï¼šæœŸæœ«ä½™é¢ä¸º Â¥0.00ã€‚</span></div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æŸ¥è¯¢ç§‘ç›®ï¼š'å…¶ä»–æµåŠ¨è´Ÿå€º'ã€'å…¶ä»–éæµåŠ¨è´Ÿå€º'æ˜ç»†... <span class="log-highlight">ç»“æœï¼šæœªå‘ç°ä¸æ­¤è¯‰è®¼äº‹é¡¹æ˜ç¡®ç›¸å…³çš„æ¬¾é¡¹ã€‚</span></div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿåˆ†æï¼šé™„æ³¨å·²æŠ«éœ²é‡å¤§æˆ–æœ‰è´Ÿå€ºäº‹é¡¹ï¼Œä¸”æŒ‡å‡ºè´¥è¯‰å¯èƒ½æ€§è¾ƒé«˜ï¼Œä½†èµ„äº§è´Ÿå€ºè¡¨ä¸­'é¢„è®¡è´Ÿå€º'ç§‘ç›®æœªäºˆç¡®è®¤ã€‚é™„æ³¨æåŠ'å…·ä½“é‡‘é¢å°šä¸èƒ½å®Œå…¨å¯é åœ°è®¡é‡'ï¼Œä½†åŒæ—¶ç»™å‡ºäº†'æ½œåœ¨æŸå¤±èŒƒå›´'å’Œ'å¯èƒ½æ€§è¾ƒé«˜'çš„åˆ¤æ–­ã€‚</div><div class="log-conclusion"><strong>ç³»ç»Ÿç»“è®º:</strong> å­˜åœ¨é™„æ³¨å®šæ€§æŠ«éœ²ä¸è´Ÿå€ºå®šé‡ç¡®è®¤ä¹‹é—´çš„<span class="log-highlight">æ½œåœ¨ä¸ä¸€è‡´æ€§</span>ã€‚è™½ç„¶é™„æ³¨å£°ç§°é‡‘é¢è®¡é‡å›°éš¾ï¼Œä½†â€œå¯èƒ½æ€§è¾ƒé«˜â€å’Œâ€œæŸå¤±èŒƒå›´â€çš„è¡¨è¿°ï¼Œéœ€è¿›ä¸€æ­¥è¯„ä¼°æ˜¯å¦å·²è¾¾åˆ°åº”ç¡®è®¤é¢„è®¡è´Ÿå€ºçš„ä¸´ç•Œç‚¹ã€‚å»ºè®®äººå·¥å¤æ ¸è¯¥äº‹é¡¹ä¼šè®¡å¤„ç†çš„æ°å½“æ€§ã€‚</div>`;
        }

        function generateNetProfitRiskSummaryHtml() {
            return `<div class="risk-summary-section"><h4>é£é™©äº‹ä»¶ï¼šå‡€åˆ©æ¶¦åŒæ¯”å¤§å¹…ä¸‹é™ <span style="color:red;">70%</span></h4><p><strong>é£é™©ç­‰çº§ï¼š</strong><span style="color:red; font-weight:bold;">é«˜</span></p><h5>æ ¸å¿ƒæŒ‡æ ‡</h5><ul><li>æœ¬æœŸå‡€åˆ©æ¶¦ï¼š<span class="key-data-highlight">Â¥355ä¸‡</span></li><li>ä¸ŠæœŸå‡€åˆ©æ¶¦ï¼šÂ¥1,183ä¸‡</li><li>åŒæ¯”å˜åŠ¨ï¼š<span style="color:red; font-weight:bold;">-70%</span></li></ul><h5>ä¸»è¦é©±åŠ¨å› ç´  (AIåˆ†æ)</h5><ul><li><strong>å­˜è´§å‡å€¼å‡†å¤‡:</strong> æœ¬æœŸè®¡æ <span class="important-note">Â¥1,000ä¸‡</span>ï¼Œå¯¹åˆ©æ¶¦äº§ç”Ÿé‡å¤§è´Ÿé¢å†²å‡»ã€‚</li><li><strong>æˆæœ¬å‹åŠ›:</strong> è¥ä¸šæ”¶å…¥ (Â¥1.50äº¿) è™½å¾®å¢3.5%ï¼Œä½†æœªèƒ½æœ‰æ•ˆè¦†ç›–è¥ä¸šæˆæœ¬åŠå„é¡¹è¥è¿è´¹ç”¨çš„ä¸Šæ¶¨ã€‚</li></ul><h5>æ½œåœ¨é£é™©ä¸å½±å“</h5><ul><li><strong>ç›ˆåˆ©èƒ½åŠ›æ¶åŒ–:</strong> å¯èƒ½é¢„ç¤ºå…¬å¸æ ¸å¿ƒç›ˆåˆ©èƒ½åŠ›å‡ºç°æ˜¾è‘—é—®é¢˜ï¼ŒæŒç»­æ€§ç»è¥é¢ä¸´æŒ‘æˆ˜ã€‚</li><li><strong>å­˜è´§ç®¡ç†é£é™©:</strong> å¤§é¢å­˜è´§å‡å€¼å¯èƒ½åæ˜ å­˜è´§ç§¯å‹ã€äº§å“è¿‡æ—¶ã€å¸‚åœºéœ€æ±‚ç–²è½¯æˆ–å†…éƒ¨ç®¡ç†ç¼ºé™·ã€‚</li><li><strong>ç°é‡‘æµå‹åŠ›:</strong> ç›ˆåˆ©ä¸‹é™é€šå¸¸ä¼´éšç»è¥æ€§ç°é‡‘æµå‡å¼±çš„é£é™©ã€‚</li><li><strong>æŠ•èµ„è€…ä¸å€ºæƒäººä¿¡å¿ƒ:</strong> ä¸šç»©å‰§çƒˆä¸‹æ»‘å¯èƒ½å½±å“å¸‚åœºä¿¡å¿ƒï¼Œå¯¹èèµ„æ¡ä»¶ã€è‚¡ä»·ç­‰äº§ç”Ÿä¸åˆ©å½±å“ã€‚</li><li><strong>å†…éƒ¨æ§åˆ¶æœ‰æ•ˆæ€§:</strong> éœ€å…³æ³¨å¯¼è‡´æ­¤çŠ¶å†µçš„å†…éƒ¨æ§åˆ¶ç¯èŠ‚æ˜¯å¦å­˜åœ¨ä¸è¶³ã€‚</li></ul><h5>å»ºè®®è¡ŒåŠ¨ä¸å…³æ³¨ç‚¹</h5><ul><li><strong>ä¸“é¡¹å®¡è®¡/å¤æ ¸:</strong> å¯¹å­˜è´§å‡å€¼çš„åŸå› ã€è®¡æå……åˆ†æ€§ä¸åˆç†æ€§è¿›è¡Œç‹¬ç«‹å¤æ ¸ã€‚</li><li><strong>æˆæœ¬æ§åˆ¶è¯„ä¼°:</strong> å…¨é¢å®¡è§†å„é¡¹æˆæœ¬è´¹ç”¨æ”¯å‡ºï¼Œè¯†åˆ«é™æœ¬å¢æ•ˆç©ºé—´ã€‚</li><li><strong>å¸‚åœºä¸é”€å”®ç­–ç•¥åˆ†æ:</strong> è¯„ä¼°å½“å‰äº§å“ç«äº‰åŠ›ã€å¸‚åœºå®šä½åŠé”€å”®ç­–ç•¥çš„æœ‰æ•ˆæ€§ã€‚</li><li><strong>ç®¡ç†å±‚è§£é‡Šä¸åº”å¯¹è®¡åˆ’:</strong> è¦æ±‚ç®¡ç†å±‚å°±åˆ©æ¶¦å¤§å¹…ä¸‹æ»‘æä¾›è¯¦ç»†è§£é‡Šï¼Œå¹¶åˆ¶å®šå…·ä½“çš„æ”¹è¿›æªæ–½ä¸ä¸šç»©ç›®æ ‡ã€‚</li></ul></div>`;
        }

        function generateProvisionPolicyReviewHtml() {
            let ts = () => new Date().toLocaleTimeString();
            return `<div class="policy-section"><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: æ­£åœ¨æ£€ç´¢å…¬å¸ã€Šä¼šè®¡æ”¿ç­–æ‰‹å†Œã€‹æ–‡æ¡£åº“...</div><div class="log-entry"><span class="log-timestamp">[${ts()}]</span> ç³»ç»Ÿ: å®šä½ç« èŠ‚ï¼š<span class="policy-keyword">ä¼šè®¡æ”¿ç­– - 22. é¢„è®¡è´Ÿå€º</span></div><h5>22.1 é¢„è®¡è´Ÿå€ºçš„ç¡®è®¤æ ‡å‡†</h5><div class="policy-excerpt"><p>ä¸æˆ–æœ‰äº‹é¡¹ç›¸å…³çš„ä¹‰åŠ¡åŒæ—¶æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„ï¼Œæœ¬å…¬å¸å°†å…¶ç¡®è®¤ä¸ºé¢„è®¡è´Ÿå€ºï¼š</p><ol><li>(1) è¯¥ä¹‰åŠ¡æ˜¯æœ¬å…¬å¸æ‰¿æ‹…çš„<span class="policy-keyword">ç°æ—¶ä¹‰åŠ¡</span>ï¼›</li><li>(2) å±¥è¡Œè¯¥ä¹‰åŠ¡<span class="policy-keyword">å¾ˆå¯èƒ½</span>å¯¼è‡´ç»æµåˆ©ç›Šæµå‡ºæœ¬å…¬å¸ï¼›</li><li>(3) è¯¥ä¹‰åŠ¡çš„é‡‘é¢èƒ½å¤Ÿ<span class="policy-keyword">å¯é åœ°è®¡é‡</span>ã€‚</li></ol></div><div class="system-check"><p><strong>ç³»ç»Ÿå¯¹æ¯”åˆ†æ (ç¡®è®¤æ ‡å‡†):</strong></p><ul><li>å·²è¯†åˆ«çš„æœªå†³è¯‰è®¼ï¼ˆåŸå‘ŠAå…¬å¸ç´¢èµ”1500ä¸‡ï¼‰ï¼š</li><li>é™„æ³¨æŠ«éœ²å¾‹å¸ˆæ„è§è®¤ä¸ºè´¥è¯‰â€œ<span class="policy-keyword">å¯èƒ½æ€§è¾ƒé«˜</span>â€ï¼ˆç¬¦åˆæ¡ä»¶2ï¼‰ã€‚</li><li>é™„æ³¨æåŠâ€œæ½œåœ¨æŸå¤±èŒƒå›´åœ¨<span class="policy-keyword">800ä¸‡å…ƒè‡³1,500ä¸‡å…ƒ</span>ä¹‹é—´â€ã€‚</li><li>ç®¡ç†å±‚è®¤ä¸ºâ€œå…·ä½“é‡‘é¢å°šä¸èƒ½<span class="policy-keyword">å®Œå…¨å¯é åœ°è®¡é‡</span>â€ï¼Œå› æ­¤æœªç¡®è®¤ï¼ˆå¯¹æ¡ä»¶3çš„åˆ¤æ–­ï¼‰ã€‚</li><li><strong>å…³æ³¨ç‚¹:</strong> åœ¨å·²çŸ¥æŸå¤±èŒƒå›´å’Œè¾ƒé«˜è´¥è¯‰å¯èƒ½æ€§çš„æƒ…å†µä¸‹ï¼Œå¯¹â€œä¸èƒ½å®Œå…¨å¯é è®¡é‡â€çš„åˆ¤æ–­æ˜¯å¦è¿‡äºè°¨æ…ï¼Œæˆ–ç¼ºä¹è¶³å¤Ÿæ”¯æŒã€‚</li></ul></div><h5>22.2 é¢„è®¡è´Ÿå€ºçš„è®¡é‡</h5><div class="policy-excerpt"><p>é¢„è®¡è´Ÿå€ºæŒ‰ç…§å±¥è¡Œç›¸å…³ç°æ—¶ä¹‰åŠ¡æ‰€éœ€æ”¯å‡ºçš„<span class="policy-keyword">æœ€ä½³ä¼°è®¡æ•°</span>è¿›è¡Œåˆå§‹è®¡é‡ã€‚</p><p>åœ¨ç¡®å®šæœ€ä½³ä¼°è®¡æ•°æ—¶ï¼Œåº”å½“ç»¼åˆè€ƒè™‘ä¸æˆ–æœ‰äº‹é¡¹æœ‰å…³çš„é£é™©ã€ä¸ç¡®å®šæ€§å’Œè´§å¸æ—¶é—´ä»·å€¼ç­‰å› ç´ ã€‚æ‰€éœ€æ”¯å‡ºå­˜åœ¨ä¸€ä¸ª<span class="policy-keyword">è¿ç»­èŒƒå›´</span>ï¼ˆæˆ–åŒºé—´ï¼‰ï¼Œä¸”è¯¥èŒƒå›´å†…å„ç§ç»“æœå‘ç”Ÿçš„å¯èƒ½æ€§ç›¸åŒçš„ï¼Œåˆ™æœ€ä½³ä¼°è®¡æ•°åº”å½“æŒ‰ç…§è¯¥èŒƒå›´å†…çš„<span class="policy-keyword">ä¸­é—´å€¼</span>å³ä¸Šä¸‹é™é‡‘é¢çš„å¹³å‡æ•°ç¡®å®šã€‚æ‰€éœ€æ”¯å‡ºä¸å­˜åœ¨ä¸€ä¸ªè¿ç»­èŒƒå›´ï¼ˆæˆ–åŒºé—´ï¼‰ï¼Œæˆ–è™½ç„¶å­˜åœ¨ä¸€ä¸ªè¿ç»­èŒƒå›´ä½†è¯¥èŒƒå›´å†…å„ç§ç»“æœå‘ç”Ÿçš„å¯èƒ½æ€§ä¸ç›¸åŒçš„ï¼Œå¦‚æˆ–æœ‰äº‹é¡¹æ¶‰åŠå•ä¸ªé¡¹ç›®çš„ï¼Œåˆ™æœ€ä½³ä¼°è®¡æ•°æŒ‰ç…§<span class="policy-keyword">æœ€å¯èƒ½å‘ç”Ÿé‡‘é¢</span>ç¡®å®šã€‚</p></div><div class="system-check"><p><strong>ç³»ç»Ÿå¯¹æ¯”åˆ†æ (è®¡é‡æ–¹æ³•):</strong></p><ul><li>é™„æ³¨å·²æä¾›æŸå¤±çš„<span class="policy-keyword">è¿ç»­èŒƒå›´</span>ï¼ˆ800ä¸‡-1500ä¸‡ï¼‰ã€‚</li><li>è‹¥æ­¤èŒƒå›´å†…å„ç§ç»“æœå¯èƒ½æ€§ç›¸åŒï¼ŒæŒ‰æ”¿ç­–åº”å–ä¸­é—´å€¼ <span class="policy-keyword">1150ä¸‡å…ƒ</span> ( (800+1500)/2 ) ä½œä¸ºæœ€ä½³ä¼°è®¡æ•°ã€‚</li><li>è‹¥å¯èƒ½æ€§ä¸åŒï¼Œéœ€åˆ¤æ–­æœ€å¯èƒ½å‘ç”Ÿé‡‘é¢ã€‚</li><li><strong>å…³æ³¨ç‚¹:</strong> å…¬å¸æ”¿ç­–æ˜ç¡®äº†åœ¨å­˜åœ¨é‡‘é¢èŒƒå›´æ—¶çš„è®¡é‡æ–¹æ³•ã€‚éœ€è¦è¯„ä¼°ç®¡ç†å±‚æ˜¯å¦æœ‰å……åˆ†ç†ç”±ä¸é‡‡ç”¨æ­¤æ–¹æ³•è¿›è¡Œä¼°è®¡ã€‚</li></ul></div><h5>22.3 æˆ–æœ‰è´Ÿå€ºçš„æŠ«éœ²</h5><div class="policy-excerpt"><p>å¯¹äºä¸æ»¡è¶³é¢„è®¡è´Ÿå€ºç¡®è®¤æ¡ä»¶çš„ç°æ—¶ä¹‰åŠ¡ï¼Œæˆ–è¿‡å»äº‹é¡¹å½¢æˆçš„æ½œåœ¨ä¹‰åŠ¡ï¼Œå…¶å±¥è¡Œæˆä¸ºç°æ—¶ä¹‰åŠ¡ä¸æ˜¯å¾ˆå¯èƒ½çš„ï¼Œæˆ–é‡‘é¢ä¸èƒ½å¯é è®¡é‡çš„ï¼Œæœ¬å…¬å¸å°†å…¶ä½œä¸ºæˆ–æœ‰è´Ÿå€ºï¼Œåœ¨è´¢åŠ¡æŠ¥è¡¨é™„æ³¨ä¸­æŠ«éœ²å…¶å½¢æˆåŸå› ã€é¢„è®¡äº§ç”Ÿçš„è´¢åŠ¡å½±å“ï¼ˆå¦‚æœèƒ½å¤Ÿé¢„è®¡ï¼‰ã€è·å¾—è¡¥å¿çš„å¯èƒ½æ€§ä»¥åŠä¸æ­¤ç›¸å…³çš„ä¸ç¡®å®šæ€§çš„æ€§è´¨ã€é‡‘é¢å’Œæ—¶é—´ã€‚</p></div><div class="system-check"><p><strong>ç³»ç»Ÿå¯¹æ¯”åˆ†æ (æŠ«éœ²):</strong></p><ul><li>å…¬å¸å·²åœ¨é™„æ³¨ä¸­æŠ«éœ²äº†è¯¥æœªå†³è¯‰è®¼ï¼Œç¬¦åˆæˆ–æœ‰è´Ÿå€ºçš„æŠ«éœ²è¦æ±‚ã€‚</li><li><strong>æ ¸å¿ƒé—®é¢˜:</strong> å¹¶éæŠ«éœ²æœ¬èº«ï¼Œè€Œæ˜¯è¯¥äº‹é¡¹æ˜¯å¦å·²ä»â€œä»…éœ€æŠ«éœ²çš„æˆ–æœ‰è´Ÿå€ºâ€è½¬å˜ä¸ºâ€œåº”ç¡®è®¤çš„é¢„è®¡è´Ÿå€ºâ€ã€‚</li></ul></div><div class="policy-review-conclusion"><p><strong>æ”¿ç­–å®¡æŸ¥åˆæ­¥ç»“è®ºï¼š</strong></p><p>å…¬å¸åˆ¶å®šçš„é¢„è®¡è´Ÿå€ºä¼šè®¡æ”¿ç­–åœ¨æ¡æ¬¾ä¸Šä¸ã€Šä¼ä¸šä¼šè®¡å‡†åˆ™ç¬¬13å·â€”â€”æˆ–æœ‰äº‹é¡¹ã€‹åŸºæœ¬ä¸€è‡´ã€‚å½“å‰é—®é¢˜çš„å…³é”®åœ¨äºå¯¹â€œé‡‘é¢èƒ½å¤Ÿå¯é åœ°è®¡é‡â€è¿™ä¸€ç¡®è®¤æ¡ä»¶çš„å®é™…åº”ç”¨å’Œåˆ¤æ–­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾‹å¸ˆå·²æä¾›â€œè´¥è¯‰å¯èƒ½æ€§è¾ƒé«˜â€åŠâ€œæ½œåœ¨æŸå¤±èŒƒå›´â€çš„æƒ…å†µä¸‹ã€‚</p><p><strong>å»ºè®®ï¼š</strong></p><ol><li>ä¸ç®¡ç†å±‚åŠæ³•å¾‹é¡¾é—®æ·±å…¥æ²Ÿé€šï¼Œè·å–å…¶å¯¹â€œé‡‘é¢ä¸èƒ½å®Œå…¨å¯é è®¡é‡â€åˆ¤æ–­çš„è¯¦ç»†ä¾æ®å’Œå®¢è§‚è¯æ®ã€‚</li><li>æ ¹æ®å…¬å¸æ”¿ç­–ä¸­å…³äºâ€œæœ€ä½³ä¼°è®¡æ•°â€çš„è®¡é‡æ–¹æ³•ï¼ˆå¦‚åŒºé—´ä¸­é—´å€¼æ³•ï¼‰ï¼Œé‡æ–°è¯„ä¼°åœ¨è¯¥è¯‰è®¼äº‹é¡¹ä¸Šç¡®è®¤é¢„è®¡è´Ÿå€ºçš„å¯è¡Œæ€§ä¸å¿…è¦æ€§ã€‚</li><li>è‹¥è¯„ä¼°ç»“æœè¡¨æ˜åº”ç¡®è®¤é¢„è®¡è´Ÿå€ºï¼Œåˆ™éœ€è€ƒè™‘å¯¹å½“æœŸè´¢åŠ¡æŠ¥è¡¨è¿›è¡Œè°ƒæ•´ï¼Œå¹¶è§£é‡Šå‰æœŸæœªç¡®è®¤çš„ç†ç”±ã€‚</li></ol></div></div>`;
        }

        function generateTeamAssignmentHtml() {
            const reportName = "è´¢å¹´2024å¹´åº¦è´¢åŠ¡æŠ¥è¡¨"; // Example report name
            const issueSummary = `åœ¨ã€Š${reportName}ã€‹çš„è´¢åŠ¡æŠ¥è¡¨ä¸­ï¼Œç³»ç»Ÿè¯†åˆ«åˆ°é™„æ³¨ä¸­æŠ«éœ²çš„â€œé‡å¤§æˆ–æœ‰è´Ÿå€ºâ€ï¼ˆå…³äºä¸Aå…¬å¸çš„æœªå†³è¯‰è®¼ï¼Œç´¢èµ”1500ä¸‡ï¼Œæ½œåœ¨æŸå¤±800-1500ä¸‡ï¼Œè´¥è¯‰å¯èƒ½æ€§è¾ƒé«˜ï¼‰ä¸èµ„äº§è´Ÿå€ºè¡¨ä¸­â€œé¢„è®¡è´Ÿå€ºâ€ç§‘ç›®ï¼ˆå½“å‰ä½™é¢ä¸ºÂ¥0ï¼‰çš„å¤„ç†å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´ã€‚`;
            const dueDate = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString('zh-CN'); // Roughly 7 days from now

            let html = `<div class="assignment-section">`;
            html += `<div class="assignment-description"><strong>äº‹é¡¹æè¿°ï¼š</strong>${issueSummary}</div>`;

            // Legal Team
            html += `<h5>æ³•åŠ¡å›¢é˜Ÿ</h5><ul>`;
            const legalTeam = [
                { name: "æä¸»ç®¡ (æ³•åŠ¡)", email: "li.fawu@example-company.com", request: "è¯·æä¾›å…³äºæ­¤è¯‰è®¼çš„æœ€æ–°æ³•å¾‹æ„è§ï¼Œç‰¹åˆ«æ˜¯å…³äºæ½œåœ¨æŸå¤±é‡‘é¢å¯è®¡é‡æ€§çš„è¯„ä¼°ï¼Œä»¥åŠç®¡ç†å±‚åˆ¤æ–­çš„ä¾æ®ã€‚" },
                { name: "ç‹é¡¾é—® (å¤–éƒ¨æ³•å¾‹)", email: "wang.legalcounsel@example-firm.com", request: "è¯·å¤æ ¸æˆ‘æ–¹æ³•åŠ¡å›¢é˜Ÿçš„æ„è§ï¼Œå¹¶å°±è¯¥äº‹é¡¹çš„æ½œåœ¨æ³•å¾‹é£é™©å’Œä¼šè®¡å¤„ç†çš„åˆè§„æ€§æä¾›ç‹¬ç«‹å»ºè®®ã€‚" }
            ];
            legalTeam.forEach((member, index) => {
                html += `<li>
                                 <div>
                                     <strong>${member.name}</strong><br>
                                     <small>${member.email}</small>
                                 </div>
                                 <button class="send-email-btn" data-recipient="${member.email}" data-name="${member.name}" data-type="legal" data-request="${member.request}">å‘é€é‚®ä»¶</button>
                                </li>`;
            });
            html += `</ul>`;

            // Audit Team
            html += `<h5>å®¡è®¡å›¢é˜Ÿ</h5><ul>`;
            const auditTeam = [
                { name: "å¼ ç»ç† (å†…éƒ¨å®¡è®¡)", email: "zhang.audit@example-company.com", request: "è¯·æ ¹æ®æœ€æ–°çš„æ³•å¾‹æ„è§å’Œå…¬å¸ä¼šè®¡æ”¿ç­–ï¼Œå¤æ ¸ç®¡ç†å±‚å¯¹è¯¥æˆ–æœ‰äº‹é¡¹çš„ä¼šè®¡å¤„ç†ï¼ˆæœªç¡®è®¤é¢„è®¡è´Ÿå€ºï¼‰æ˜¯å¦æ°å½“ï¼Œå¹¶è¯„ä¼°ç›¸å…³å†…éƒ¨æ§åˆ¶çš„æœ‰æ•ˆæ€§ã€‚" },
                { name: "èµµåˆä¼™äºº (XYZ CPA)", email: "zhao.partner@xyz-cpa.com", request: "è¯·å…³æ³¨æ­¤äº‹é¡¹ï¼Œå¹¶åœ¨åç»­å®¡è®¡å·¥ä½œä¸­äºˆä»¥é‡ç‚¹æ ¸æŸ¥ã€‚æˆ‘ä»¬å°†åœ¨è·å–æ›´å…¨é¢çš„æ³•å¾‹æ„è§åä¸æ‚¨è¿›ä¸€æ­¥æ²Ÿé€šã€‚" }
            ];
            auditTeam.forEach((member, index) => {
                html += `<li>
                                 <div>
                                     <strong>${member.name}</strong><br>
                                     <small>${member.email}</small>
                                 </div>
                                 <button class="send-email-btn" data-recipient="${member.email}" data-name="${member.name}" data-type="audit" data-request="${member.request}">å‘é€é‚®ä»¶</button>
                                </li>`;
            });
            html += `</ul>`;
            html += `</div>`;
            return html;
        }

        function addTeamAssignmentEventListeners() {
            document.querySelectorAll('.send-email-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const recipient = this.dataset.recipient;
                    const name = this.dataset.name;
                    //const type = this.dataset.type; // 'legal' or 'audit'
                    const specificRequest = this.dataset.request;
                    const reportName = "è´¢å¹´2024å¹´åº¦è´¢åŠ¡æŠ¥è¡¨"; // Consistent with above
                    const dueDate = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString('zh-CN');

                    const subject = `ä»»åŠ¡åˆ†é…ï¼šå¤æ ¸ã€Š${reportName}ã€‹ä¸­æˆ–æœ‰è´Ÿå€ºäº‹é¡¹`;
                    let body = `ä½ å¥½ ${name}ï¼Œ\n\n`;
                    body += `è¯·ååŠ©å¤æ ¸è´¢åŠ¡æŠ¥è¡¨æ™ºèƒ½è§£æç³»ç»Ÿåœ¨ã€Š${reportName}ã€‹ä¸­è¯†åˆ«çš„ä¸€é¡¹åˆè§„å…³æ³¨ç‚¹ã€‚\n\n`;
                    body += `é—®é¢˜æ¦‚è¿°ï¼šç³»ç»Ÿè¯†åˆ«åˆ°é™„æ³¨ä¸­æŠ«éœ²çš„â€œé‡å¤§æˆ–æœ‰è´Ÿå€ºâ€ï¼ˆå…³äºä¸Aå…¬å¸çš„æœªå†³è¯‰è®¼ï¼Œç´¢èµ”1500ä¸‡ï¼Œæ½œåœ¨æŸå¤±800-1500ä¸‡ï¼Œå¾‹å¸ˆè®¤ä¸ºè´¥è¯‰å¯èƒ½æ€§è¾ƒé«˜ï¼‰ä¸èµ„äº§è´Ÿå€ºè¡¨ä¸­â€œé¢„è®¡è´Ÿå€ºâ€ç§‘ç›®ï¼ˆå½“å‰ä½™é¢ä¸ºÂ¥0ï¼‰çš„ä¼šè®¡å¤„ç†å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´ã€‚\n\n`;
                    body += `å…·ä½“è¦æ±‚ï¼š${specificRequest}\n\n`;
                    body += `è¯·åœ¨ ${dueDate} å‰å›é¦ˆæ‚¨çš„åˆæ­¥æ„è§ã€‚\n\n`;
                    body += `æ„Ÿè°¢æ‚¨çš„ååŠ©ï¼\n\n`;
                    body += `æ­¤è‡´ï¼Œ\nè´¢åŠ¡æŠ¥è¡¨æ™ºèƒ½è§£æç³»ç»Ÿ (è‡ªåŠ¨åˆ†æ´¾)`;

                    const mailtoLink = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.location.href = mailtoLink;

                    // Visually indicate mail has been "sent"
                    this.textContent = 'é‚®ä»¶å·²ç”Ÿæˆ âœ“';
                    this.style.backgroundColor = '#5cb85c'; // Green
                    this.disabled = true;
                });
            });
        }


        // --- Main Demo Process (startDataInputProcess, startModelingProcess) ---
        async function startDataInputProcess() {
            if (demoInProgress || !uploadArea) return;
            demoInProgress = true;
            resetDataInputDemo(); // Ensure clean state
            demoInProgress = true; // Set again after reset

            uploadArea.style.display = 'none';
            progressBarContainer.style.display = 'block';
            processingVisualization.style.display = 'block';

            await updateVisualStep(uploadVisual, null, 'è´¢åŠ¡æŠ¥è¡¨_å¹´åº¦.pdf ä¸Šä¼ æˆåŠŸ', 100); overallProgress.style.width = '5%';
            await updateVisualStep(ocrVisual, 'æ™ºèƒ½OCRè¯†åˆ«ï¼šæå–æ–‡æœ¬ä¸æ•°æ®...', '<div class="spinner"></div> è¿›è¡Œä¸­', 700); await new Promise(r => setTimeout(r, 1200));
            await updateVisualStep(ocrVisual, 'æ™ºèƒ½OCRè¯†åˆ«ï¼šæå–æ–‡æœ¬ä¸æ•°æ®...', 'å®Œæˆ'); overallProgress.style.width = '25%';
            await updateVisualStep(structureVisual, 'è¡¨æ ¼ç»“æ„è¿˜åŸä¸é™„æ³¨å†…å®¹è§£æ...', '<div class="spinner"></div> è¿›è¡Œä¸­', 400); await new Promise(r => setTimeout(r, 1500));
            await updateVisualStep(structureVisual, 'è¡¨æ ¼ç»“æ„è¿˜åŸä¸é™„æ³¨å†…å®¹è§£æ...', 'å®Œæˆ'); overallProgress.style.width = '50%';
            await updateVisualStep(outputVisual, 'åˆæ­¥ç»“æ„åŒ–æ•°æ®ç”Ÿæˆ...', '<div class="spinner"></div> è¿›è¡Œä¸­', 400); await new Promise(r => setTimeout(r, 1000));
            await updateVisualStep(outputVisual, 'åˆæ­¥ç»“æ„åŒ–æ•°æ®ç”Ÿæˆ...', 'å®Œæˆ'); overallProgress.style.width = '60%';

            setTimeout(() => {
                if(!ocrResultsArea || !ocrOutput) return;
                ocrResultsArea.classList.add('show');
                ocrOutput.innerHTML = `<table class="data-table"><thead><tr><th>ç§‘ç›®åç§°</th><th>æœ¬æœŸé‡‘é¢</th><th>ä¸ŠæœŸé‡‘é¢</th><th>è¯†åˆ«ç½®ä¿¡åº¦</th></tr></thead><tbody><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="è´§å¸èµ„é‡‘">è´§å¸èµ„é‡‘</a></td><td>12,345,678.90</td><td>10,234,567.80</td><td>99.2%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="åº”æ”¶ç¥¨æ®åŠåº”æ”¶è´¦æ¬¾">åº”æ”¶ç¥¨æ®åŠåº”æ”¶è´¦æ¬¾</a></td><td>8,765,432.10</td><td>9,876,543.20</td><td>97.5%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="å­˜è´§">å­˜è´§</a></td><td>25,430,120.50</td><td>20,115,780.30</td><td>98.1%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="å›ºå®šèµ„äº§å‡€é¢">å›ºå®šèµ„äº§å‡€é¢</a></td><td>45,678,901.23</td><td>48,765,432.10</td><td>98.8%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="è¥ä¸šæ”¶å…¥">è¥ä¸šæ”¶å…¥</a></td><td>150,321,678.00</td><td>145,123,890.50</td><td>99.5%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="è¥ä¸šåˆ©æ¶¦">è¥ä¸šåˆ©æ¶¦</a></td><td>5,120,300.00</td><td>6,035,200.00</td><td>99.0%</td></tr><tr><td><a href="javascript:void(0);" class="account-link-simulation" data-account="å‡€åˆ©æ¶¦">å‡€åˆ©æ¶¦</a></td><td>3,550,800.00</td><td>11,836,000.00</td><td>99.1%</td></tr></tbody></table><p style="margin-top:20px;text-align:center;color:#555;"><strong>åˆæ­¥è§£æå®Œæˆï¼</strong> æ ¸å¿ƒè´¢åŠ¡æ•°æ®ä¸é™„æ³¨å…³é”®ä¿¡æ¯å·²æå–ã€‚å¯ç‚¹å‡»ç§‘ç›®åç§°æŸ¥çœ‹æ˜ç»†ã€‚</p>`;
                document.querySelectorAll('.account-link-simulation').forEach(link => link.addEventListener('click', function() { openModal(`${this.getAttribute('data-account')} - æ˜ç»†`, generateAccountDetailHtml(this.getAttribute('data-account'))); }));
                startModelingProcess();
            }, 500);
        }

        async function startModelingProcess() {
            if(!modelingSection || !overallProgress) return;
            modelingSection.style.display = 'block'; overallProgress.style.width = '65%';
            const balanceSheetStatusEl = document.getElementById('balanceSheetStatus');
            const incomeStatementStatusEl = document.getElementById('incomeStatementStatus');
            const cashFlowStatusEl = document.getElementById('cashFlowStatus');
            const dataQualityStatusEl = document.getElementById('dataQualityStatus');

            await new Promise(r => setTimeout(r, 700)); if(balanceSheetStatusEl) balanceSheetStatusEl.innerHTML = '<span style="color:#28a745;font-weight:bold;">âœ“ é€šè¿‡</span>'; overallProgress.style.width = '70%';
            await new Promise(r => setTimeout(r, 700));
            if(incomeStatementStatusEl) {
                incomeStatementStatusEl.innerHTML = '<span style="color:orange;font-weight:bold;">âš  éƒ¨åˆ†ç§‘ç›®éœ€å…³æ³¨</span>';
                const indicator = incomeStatementStatusEl.previousElementSibling.querySelector('.status-indicator');
                if (indicator) indicator.className = 'status-indicator warning';
            }
            overallProgress.style.width = '75%';
            await new Promise(r => setTimeout(r, 700)); if(cashFlowStatusEl) cashFlowStatusEl.innerHTML = '<span style="color:#28a745;font-weight:bold;">âœ“ é€šè¿‡</span>'; overallProgress.style.width = '80%';
            await new Promise(r => setTimeout(r, 700)); if(dataQualityStatusEl) dataQualityStatusEl.innerHTML = '<span style="color:#28a745;font-weight:bold;">âœ“ é«˜è´¨é‡</span>'; overallProgress.style.width = '85%';

            setTimeout(() => {
                if(!modelingResultsArea || !modelingOutput) return;
                modelingResultsArea.classList.add('show');
                modelingOutput.innerHTML = `
                    <div class="automated-finding-card">
                        <div class="finding-header"><span class="icon">âš ï¸</span><span class="title">é«˜ä¼˜å…ˆçº§è­¦ç¤ºï¼šå‡€åˆ©æ¶¦æ˜¾è‘—ä¸‹é™</span><span class="priority-tag high">é«˜</span></div>
                        <div class="finding-content">
                            <div class="finding-section"><h6>æ ¸å¿ƒå‘ç°</h6><p>ç³»ç»Ÿæ£€æµ‹åˆ°æœ¬æœŸå‡€åˆ©æ¶¦è¾ƒä¸ŠæœŸ<span class="key-data-highlight">åŒæ¯”ä¸‹é™70%</span>ï¼ˆæœ¬æœŸ <span class="key-data-highlight">Â¥355ä¸‡</span> vs. ä¸ŠæœŸ <span class="key-data-highlight">Â¥1,183ä¸‡</span>ï¼‰ï¼Œå·²è§¦å‘â€œå‰§çƒˆæ³¢åŠ¨â€é¢„è­¦é˜ˆå€¼ã€‚</p></div>
                            <div class="finding-section"><h6>AIæ™ºèƒ½å½’å› åˆ†æ</h6><p>å¤§æ¨¡å‹ç»“åˆè´¢åŠ¡æ•°æ®ä¸é™„æ³¨åˆ†æï¼Œä¸»è¦å½’å› å¦‚ä¸‹ï¼š</p><ul><li>è¥ä¸šæ”¶å…¥ï¼ˆ<span class="key-data-highlight">Â¥1.50äº¿</span>ï¼‰åŒæ¯”å¾®å¢3.5%ï¼Œä½†ä¸è¶³ä»¥è¦†ç›–æˆæœ¬å¢å¹…ã€‚</li><li>èµ„äº§å‡å€¼æŸå¤±å¤§å¹…å¢åŠ æ˜¯å…³é”®å› ç´ ï¼šé™„æ³¨æŠ«éœ²æœ¬æœŸè®¡æäº†<span class="important-note">Â¥1,000ä¸‡</span>çš„å­˜è´§è·Œä»·å‡†å¤‡ã€‚</li><li>å…¶ä»–ç»è¥æˆæœ¬åŠè´¹ç”¨äº¦æœ‰ä¸Šå‡ã€‚</li></ul></div>
                            <div class="finding-section"><h6>æ½œåœ¨å½±å“ä¸å»ºè®®</h6><p>è¯¥å‰§çƒˆæ³¢åŠ¨å¯èƒ½é¢„ç¤ºå…¬å¸ç›ˆåˆ©èƒ½åŠ›å‡ºç°æ˜¾è‘—ä¸‹æ»‘ï¼Œæˆ–å­˜è´§ç®¡ç†å­˜åœ¨è¾ƒå¤§é£é™©ã€‚ç®¡ç†å±‚åº”é‡ç‚¹å…³æ³¨ï¼š</p><ul><li>å­˜è´§è·Œä»·å‡†å¤‡è®¡æçš„å……åˆ†æ€§ã€åˆç†æ€§åŠèƒŒåæ·±å±‚åŸå› ã€‚</li><li>æˆæœ¬æ§åˆ¶æœ‰æ•ˆæ€§åŠæœªæ¥ç›ˆåˆ©è¶‹åŠ¿ã€‚</li></ul></div>
                        </div>
                        <div class="finding-actions">
                            <a href="javascript:void(0);" class="action-button-sim" id="viewIncomeStatementBtn">æŸ¥é˜…åˆ©æ¶¦è¡¨ç»†ç›®</a>
                            <a href="javascript:void(0);" class="action-button-sim" id="analyzeInventoryImpairmentBtn">åˆ†æå­˜è´§å‡å€¼è¯¦æƒ…</a>
                            <a href="javascript:void(0);" class="action-button-sim secondary" id="markForReviewNetProfitBtn">æ ‡è®°ä¸ºå¾…å¤æ ¸</a>
                            <a href="javascript:void(0);" class="action-button-sim secondary" id="generateRiskSummaryNetProfitBtn">ç”Ÿæˆé£é™©æ‘˜è¦</a>
                        </div>
                    </div>
                    <div class="automated-finding-card">
                        <div class="finding-header"><span class="icon">â—</span><span class="title">åˆè§„å…³æ³¨ï¼šé™„æ³¨ä¸è´¢åŠ¡æ•°æ®å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´</span><span class="priority-tag medium">ä¸­</span></div>
                        <div class="finding-content">
                            <div class="finding-section"><h6>æ ¸å¿ƒå‘ç°</h6><p>ç³»ç»Ÿåœ¨äº¤å‰éªŒè¯ä¸­å‘ç°ï¼ŒæŠ¥è¡¨é™„æ³¨ä¸­å®šæ€§æŠ«éœ²äº†<span class="important-note">â€œé‡å¤§æˆ–æœ‰è´Ÿå€ºâ€</span>äº‹é¡¹ï¼Œä½†èµ„äº§è´Ÿå€ºè¡¨ç›¸å…³ç§‘ç›®ï¼ˆå¦‚â€œé¢„è®¡è´Ÿå€ºâ€ï¼‰æœªèƒ½å……åˆ†ã€å‡†ç¡®åœ°å®šé‡åæ˜ æ­¤ä¿¡æ¯ã€‚</p></div>
                            <div class="finding-section"><h6>AIæ™ºèƒ½å½’å› åˆ†æ</h6><ul><li>é™„æ³¨æ–‡æœ¬è¯†åˆ«ï¼šâ€œå…¬å¸å­˜åœ¨ä¸€é¡¹æœªå†³è¯‰è®¼ï¼Œç›¸å…³ç´¢èµ”é‡‘é¢é‡å¤§ï¼Œå¯èƒ½å¯¼è‡´æœªæ¥ç»æµåˆ©ç›Šæµå‡ºâ€¦â€</li><li>æ•°æ®æ¯”å¯¹ï¼šèµ„äº§è´Ÿå€ºè¡¨ä¸­â€œé¢„è®¡è´Ÿå€ºâ€ç§‘ç›®ä½™é¢ä¸º<span class="key-data-highlight">Â¥0</span>ï¼Œå…¶ä»–è´Ÿå€ºç±»ç§‘ç›®äº¦æœªè§æ˜ç¡®å¯¹åº”æˆ–å……åˆ†è§£é‡Šã€‚</li></ul></div>
                            <div class="finding-section"><h6>æ½œåœ¨é£é™©ä¸å»ºè®®</h6><p>æ­¤ç§ä¸ä¸€è‡´å¯èƒ½æ„æˆè´¢åŠ¡æŠ¥å‘Šé”™æŠ¥æˆ–ä¿¡æ¯æŠ«éœ²ä¸å®Œæ•´ã€ä¸å‡†ç¡®çš„é£é™©ï¼Œå½±å“è´¢åŠ¡æŠ¥è¡¨çš„å¯é æ€§ä¸åˆè§„æ€§ã€‚å»ºè®®ï¼š</p><ul><li>ç«‹å³æ ¸æŸ¥è¯¥æˆ–æœ‰äº‹é¡¹çš„æœ€æ–°è¿›å±•åŠå…¶ä¼šè®¡å¤„ç†æ˜¯å¦ç¬¦åˆä¼ä¸šä¼šè®¡å‡†åˆ™å…³äºé¢„è®¡è´Ÿå€ºçš„ç¡®è®¤ä¸è®¡é‡è¦æ±‚ã€‚</li><li>ç¡®ä¿ä¿¡æ¯æŠ«éœ²çš„åŠæ—¶ã€å®Œæ•´ã€å‡†ç¡®ï¼Œé¿å…è¯¯å¯¼æŠ•èµ„è€…åŠç›‘ç®¡æœºæ„ã€‚</li></ul></div>
                        </div>
                        <div class="finding-actions">
                            <a href="javascript:void(0);" class="action-button-sim" id="checkContingentLiabilityBtn">æ ¸å¯¹é™„æ³¨åŸæ–‡ä¸åˆ†ç±»</a>
                            <a href="javascript:void(0);" class="action-button-sim" id="reviewProvisionPolicyBtn">å®¡æŸ¥é¢„è®¡è´Ÿå€ºä¼šè®¡æ”¿ç­–</a>
                            <a href="javascript:void(0);" class="action-button-sim secondary" id="assignToTeamsBtn">åˆ†é…ç»™æ³•åŠ¡/å®¡è®¡å›¢é˜Ÿ</a>
                        </div>
                    </div>`;

                document.getElementById('viewIncomeStatementBtn').addEventListener('click', () => openModal('åˆ©æ¶¦è¡¨è¯¦ç»†ç§‘ç›®', generateIncomeStatementDetailHtml()));
                document.getElementById('analyzeInventoryImpairmentBtn').addEventListener('click', () => openModal('å­˜è´§è·Œä»·å‡†å¤‡è®¡æè¯¦æƒ…', generateInventoryImpairmentDetailHtml()));
                document.getElementById('checkContingentLiabilityBtn').addEventListener('click', () => openModal('æ ¸å¯¹é™„æ³¨åŸæ–‡ä¸åˆ†ç±» - ç³»ç»Ÿå¤„ç†æ—¥å¿— (æ¨¡æ‹Ÿ)', generateNotesCheckDetailHtml()));

                const markForReviewBtn = document.getElementById('markForReviewNetProfitBtn');
                if(markForReviewBtn) markForReviewBtn.addEventListener('click', function() { this.textContent = 'å·²æ ‡è®°å¾…å¤æ ¸ âœ“'; this.classList.add('actioned'); });

                const genRiskSummaryBtn = document.getElementById('generateRiskSummaryNetProfitBtn');
                if(genRiskSummaryBtn) genRiskSummaryBtn.addEventListener('click', () => openModal('å‡€åˆ©æ¶¦ä¸‹é™ - é£é™©æ‘˜è¦ (æ¨¡æ‹Ÿ)', generateNetProfitRiskSummaryHtml()));

                const reviewPolicyBtn = document.getElementById('reviewProvisionPolicyBtn');
                if(reviewPolicyBtn) reviewPolicyBtn.addEventListener('click', () => openModal('å®¡æŸ¥é¢„è®¡è´Ÿå€ºä¼šè®¡æ”¿ç­– (æ¨¡æ‹Ÿ)', generateProvisionPolicyReviewHtml()));

                const assignTeamsBtn = document.getElementById('assignToTeamsBtn');
                if(assignTeamsBtn) assignTeamsBtn.addEventListener('click', () => {
                    openModal('åˆ†é…ä»»åŠ¡ï¼šå¤æ ¸æˆ–æœ‰è´Ÿå€ºäº‹é¡¹', generateTeamAssignmentHtml(), addTeamAssignmentEventListeners);
                });


                overallProgress.style.width = '100%'; demoInProgress = false;
            }, 1000);
        }

        // --- Budget Control Page Logic ---
        const budgetProcessingStatusEl = document.getElementById('budgetProcessingStatus');
        const budgetProcessingTextEl = document.getElementById('budgetProcessingText');
        const budgetProgressFillEl = document.getElementById('budgetProgressFill');
        const deptBudgetStatusEl = document.getElementById('deptBudgetStatus');
        const actualsSyncStatusEl = document.getElementById('actualsSyncStatus');
        const budgetDashboardEl = document.getElementById('budgetDashboard');
        const budgetAnalysisOutputEl = document.getElementById('budgetAnalysisOutput');
        const budgetDetailedAnalysisSectionEl = document.getElementById('budgetDetailedAnalysisSection');


        function resetBudgetControlDemo() {
            if(budgetProcessingStatusEl) budgetProcessingStatusEl.style.display = 'none';
            if(budgetProgressFillEl) budgetProgressFillEl.style.width = '0%';
            if(deptBudgetStatusEl) deptBudgetStatusEl.textContent = 'ç­‰å¾…å¯¼å…¥';
            if(actualsSyncStatusEl) actualsSyncStatusEl.textContent = 'ç­‰å¾…åŒæ­¥';
            if(budgetDashboardEl) budgetDashboardEl.style.display = 'none';

            const deptExecutionChartEl = document.getElementById('deptExecutionChart');
            if(deptExecutionChartEl) deptExecutionChartEl.innerHTML = '';

            const varianceAlertsPanelEl = document.getElementById('varianceAlertsPanel');
            if(varianceAlertsPanelEl) varianceAlertsPanelEl.innerHTML = '';

            const budgetStatsCardsEl = document.getElementById('budgetStatsCards');
            if(budgetStatsCardsEl) budgetStatsCardsEl.innerHTML = '';

            if(budgetDetailedAnalysisSectionEl) budgetDetailedAnalysisSectionEl.classList.remove('show');
            if(budgetAnalysisOutputEl) budgetAnalysisOutputEl.innerHTML = '';
            closeModal(); // Close any open modals related to budget
        }

        async function simulateBudgetProcess(actionType) {
            if(!budgetProcessingStatusEl || !budgetDashboardEl || !budgetDetailedAnalysisSectionEl || !budgetAnalysisOutputEl || !budgetProgressFillEl || !budgetProcessingTextEl) return;

            budgetProcessingStatusEl.style.display = 'block';
            budgetDashboardEl.style.display = 'none';
            budgetDetailedAnalysisSectionEl.classList.remove('show');
            budgetAnalysisOutputEl.innerHTML = '';
            budgetProgressFillEl.style.width = '0%';


            let actionTextStart = actionType === 'api_sync' ? 'ç³»ç»Ÿå¯¹æ¥åŒæ­¥' : 'Excelå¯¼å…¥å¤„ç†';

            budgetProcessingTextEl.textContent = `${actionTextStart}ï¼šæ­£åœ¨å‡†å¤‡...`;
            budgetProgressFillEl.style.width = '10%';
            await new Promise(r => setTimeout(r, 300));

            if (actionType === 'api_sync') {
                budgetProcessingTextEl.textContent = `ç³»ç»Ÿå¯¹æ¥åŒæ­¥ï¼šæ­£åœ¨è¿æ¥é¢„ç®—ç®¡ç†ç³»ç»Ÿ...`;
                await new Promise(r => setTimeout(r, 500));
                budgetProgressFillEl.style.width = '25%';

                budgetProcessingTextEl.textContent = `ç³»ç»Ÿå¯¹æ¥åŒæ­¥ï¼šæ­£åœ¨æ‹‰å–éƒ¨é—¨é¢„ç®—æ•°æ®...`;
                if(deptBudgetStatusEl) deptBudgetStatusEl.textContent = 'APIæ‹‰å–ä¸­...';
                await new Promise(r => setTimeout(r, 1000));
                budgetProgressFillEl.style.width = '50%';
                if(deptBudgetStatusEl) deptBudgetStatusEl.innerHTML = '<span style="color: #28a745; font-weight: bold;">APIé¢„ç®—æ•°æ®å·²å¯¼å…¥ âœ“</span>';

                budgetProcessingTextEl.textContent = `ç³»ç»Ÿå¯¹æ¥åŒæ­¥ï¼šæ­£åœ¨åŒæ­¥æœ€æ–°å®é™…å‘ç”Ÿæ•°...`;
                if(actualsSyncStatusEl) actualsSyncStatusEl.textContent = 'APIåŒæ­¥ä¸­...';
                await new Promise(r => setTimeout(r, 1000));
                budgetProgressFillEl.style.width = '80%';
                if(actualsSyncStatusEl) actualsSyncStatusEl.innerHTML = '<span style="color: #28a745; font-weight: bold;">APIå®é™…æ•°å·²åŒæ­¥ âœ“</span>';

            } else { // excel_import
                budgetProcessingTextEl.textContent = `Excelå¯¼å…¥å¤„ç†ï¼šæ­£åœ¨è§£æé¢„ç®—Excelæ–‡ä»¶...`;
                await new Promise(r => setTimeout(r, 700));
                budgetProgressFillEl.style.width = '30%';

                budgetProcessingTextEl.textContent = `Excelå¯¼å…¥å¤„ç†ï¼šæ­£åœ¨æ ¡éªŒå¹¶å¯¼å…¥éƒ¨é—¨é¢„ç®—æ•°æ®...`;
                if(deptBudgetStatusEl) deptBudgetStatusEl.textContent = 'Excelè§£æä¸­...';
                await new Promise(r => setTimeout(r, 1200));
                budgetProgressFillEl.style.width = '60%';
                if(deptBudgetStatusEl) deptBudgetStatusEl.innerHTML = '<span style="color: #28a745; font-weight: bold;">Excelé¢„ç®—æ•°æ®å·²å¯¼å…¥ âœ“</span>';

                budgetProcessingTextEl.textContent = `Excelå¯¼å…¥å¤„ç†ï¼šæ¨¡æ‹Ÿä»ä¼šè®¡ç³»ç»ŸåŒæ­¥å®é™…å‘ç”Ÿæ•°...`;
                if(actualsSyncStatusEl) actualsSyncStatusEl.textContent = 'æ¨¡æ‹ŸåŒæ­¥ä¸­...';
                await new Promise(r => setTimeout(r, 800));
                budgetProgressFillEl.style.width = '85%';
                if(actualsSyncStatusEl) actualsSyncStatusEl.innerHTML = '<span style="color: #28a745; font-weight: bold;">å®é™…æ•°å·²åŒæ­¥ (æ¨¡æ‹Ÿ) âœ“</span>';
            }

            budgetProcessingTextEl.textContent = `${actionTextStart}ï¼šæ•°æ®å¤„ç†å®Œæˆï¼Œç”Ÿæˆçœ‹æ¿...`;
            budgetProgressFillEl.style.width = '100%';
            await new Promise(r => setTimeout(r, 500));

            budgetProcessingStatusEl.style.display = 'none';
            displayBudgetDashboard();
            budgetDashboardEl.style.display = 'block';
        }

        const syncBudgetSystemBtn = document.getElementById('syncBudgetSystemBtn');
        if(syncBudgetSystemBtn) syncBudgetSystemBtn.addEventListener('click', () => {
            simulateBudgetProcess('api_sync');
        });

        const importBudgetExcelBtn = document.getElementById('importBudgetExcelBtn');
        if(importBudgetExcelBtn) importBudgetExcelBtn.addEventListener('click', () => {
             simulateBudgetProcess('excel_import');
        });
        const budgetExcelUploadEl = document.getElementById('budgetExcelUpload');
        if(budgetExcelUploadEl) budgetExcelUploadEl.addEventListener('click', () => {
            alert("æ¨¡æ‹Ÿæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼šè¯·é€‰æ‹©æ‚¨çš„é¢„ç®—Excelæ–‡ä»¶ã€‚åœ¨æ­¤æ¼”ç¤ºä¸­ï¼Œè¯·ç›´æ¥ç‚¹å‡»â€œå¯¼å…¥é¢„ç®—è¡¨â€æŒ‰é’®ã€‚");
        });


        function displayBudgetDashboard() {
            // 1. Populate Execution Rate Chart
            const chartContainer = document.getElementById('deptExecutionChart');
            if(!chartContainer) return;
            chartContainer.innerHTML = ''; // Clear previous
            const deptData = [
                { name: 'å¸‚åœºéƒ¨', actual: 650000, budget: 500000, rate: 130 }, // Over budget
                { name: 'ç ”å‘éƒ¨', actual: 680000, budget: 800000, rate: 85 },  // Under budget
                { name: 'è¿è¥éƒ¨', actual: 300000, budget: 300000, rate: 100 },
                { name: 'è¡Œæ”¿éƒ¨', actual: 224000, budget: 200000, rate: 112 }, // Over budget
                { name: 'é”€å”®éƒ¨', actual: 900000, budget: 1000000, rate: 90 }
            ];
            deptData.forEach(dept => {
                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = dept.name;
                const barWrapper = document.createElement('div');
                barWrapper.className = 'bar-wrapper';
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.width = `${Math.min(dept.rate, 150)}%`; // Cap width for display
                if (dept.rate > 100) bar.classList.add('over-budget');

                const percentageLabel = document.createElement('span');
                percentageLabel.className = 'percentage-label';
                percentageLabel.textContent = `${dept.rate}%`;

                bar.appendChild(percentageLabel);
                barWrapper.appendChild(bar);
                barGroup.appendChild(label);
                barGroup.appendChild(barWrapper);
                chartContainer.appendChild(barGroup);
            });

            // 2. Populate Variance Alerts
            const alertsPanel = document.getElementById('varianceAlertsPanel');
            if(!alertsPanel) return;
            alertsPanel.innerHTML = '';
            const alertsData = [
                { id: 'market_promo', title: 'å¸‚åœºæ¨å¹¿è´¹ï¼šè¶…å‡ºé¢„ç®—30%', details: 'é¢„ç®—: 500,000 | å®é™…: 650,000 | åå·®: +150,000', type: 'high-alert', dataTarget: 'MarketPromoVariance' },
                { id: 'rnd_expenditure', title: 'ç ”å‘æ”¯å‡ºï¼šä½äºé¢„ç®—15%', details: 'é¢„ç®—: 800,000 | å®é™…: 680,000 | åå·®: -120,000', type: 'normal', dataTarget: 'RnDVariance'},
                { id: 'admin_office', title: 'è¡Œæ”¿åŠå…¬è´¹ï¼šè¶…å‡ºé¢„ç®—12%', details: 'é¢„ç®—: 200,000 | å®é™…: 224,000 | åå·®: +24,000', type: 'normal', dataTarget: 'AdminVariance' }
            ];
            alertsData.forEach(alertData => {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert-item ${alertData.type}`;
                alertDiv.innerHTML = `<h6>${alertData.title}</h6><p>${alertData.details}</p>`;
                alertDiv.addEventListener('click', () => showBudgetVarianceDetail(alertData.dataTarget));
                alertsPanel.appendChild(alertDiv);
            });

            // 3. Populate Budget Statistics
            const statsContainer = document.getElementById('budgetStatsCards');
            if(!statsContainer) return;
            statsContainer.innerHTML = '';
            const statsData = [
                { value: '95%', label: 'æœ¬å­£åº¦é¢„ç®—æ‰§è¡Œè¿›åº¦', class: '', action: 'showQuarterlyProgressDetail' }, // MODIFIED: Added action
                { value: '3', label: 'è¶…é¢„ç®—é¡¹ç›®æ•° (éœ€å…³æ³¨)', class: 'red', action: 'showOverBudgetDetails' },
                { value: '2', label: 'æœªè¾¾é¢„ç®—é¡¹ç›®æ•° (éœ€è·Ÿè¸ª)', class: 'orange', action: 'showUnderBudgetDetails' }
            ];
            statsData.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'budget-stat-card';
                card.innerHTML = `<div class="value ${stat.class}">${stat.value}</div><div class="label">${stat.label}</div>`;
                if (stat.action) {
                    card.classList.add('clickable');
                    card.addEventListener('click', () => {
                        if (stat.action === 'showOverBudgetDetails') {
                            showOverBudgetItemsDetail();
                        } else if (stat.action === 'showUnderBudgetDetails') {
                            showUnderBudgetItemsDetail();
                        } else if (stat.action === 'showQuarterlyProgressDetail') { // NEW: Handle click for quarterly progress
                            showQuarterlyBudgetProgressDetail();
                        }
                    });
                }
                statsContainer.appendChild(card);
            });
        }

        // NEW FUNCTION: Show quarterly budget progress detail modal
        function showQuarterlyBudgetProgressDetail() {
            const title = "æœ¬å­£åº¦é¢„ç®—æ‰§è¡Œè¿›åº¦è¯¦æƒ…";
            const contentHtml = generateQuarterlyBudgetProgressDetailHtml();
            openModal(title, contentHtml);
        }

        // NEW FUNCTION: Generate HTML for quarterly budget progress detail
        function generateQuarterlyBudgetProgressDetailHtml() {
            const overallProgressPercent = 95; // From the card
            const quarter = "Q2 2025"; // Assumed, or can be dynamic
            const asOfDate = new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' }); // Dynamic date

            const totalBudget = 5000000;
            const actualSpending = totalBudget * (overallProgressPercent / 100);
            const remainingBudget = totalBudget - actualSpending;

            const breakdownData = [
                { name: 'è¿è¥éƒ¨é—¨', budget: 2000000, actual: 1950000, note: "æ ¸å¿ƒé¡¹ç›®æŒ‰è®¡åˆ’æ”¯å‡ºï¼Œæ¥è¿‘é¢„ç®—ä¸Šé™ã€‚" },
                { name: 'å¸‚åœºéƒ¨é—¨', budget: 1000000, actual: 980000, note: "å¤§å‹æ¨å¹¿æ´»åŠ¨å·²å®Œæˆï¼Œè´¹ç”¨æ§åˆ¶åœ¨é¢„æœŸå†…ã€‚" },
                { name: 'ç ”å‘éƒ¨é—¨', budget: 1500000, actual: 1400000, note: "æ–°äº§å“Alphaçº¿æŠ•å…¥ç¬¦åˆé¢„æœŸï¼Œéƒ¨åˆ†æ¨¡å—æˆæœ¬ä¼˜åŒ–ã€‚" },
                { name: 'è¡Œæ”¿éƒ¨é—¨', budget: 500000, actual: 420000, note: "æ—¥å¸¸è¿è¥æ”¯å‡ºå¹³ç¨³ï¼Œéƒ¨åˆ†é‡‡è´­è®¡åˆ’å»¶åã€‚" }
            ];

            let html = `<h4>${quarter}é¢„ç®—æ‰§è¡Œè¿›åº¦ (æˆªè‡³ ${asOfDate})</h4>`;
            html += `<p style="margin-top:10px;"><strong>æ€»ä½“æ‰§è¡Œç‡: <span style="color: #667eea; font-size: 1.2em;">${overallProgressPercent}%</span></strong></p>`;
            html += `<table class="modal-table" style="margin-top:15px;">
                            <tbody>
                                <tr><td style="font-weight:500;">æ€»é¢„ç®—é¢</td><td>${totalBudget.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</td></tr>
                                <tr><td style="font-weight:500;">ç´¯è®¡å·²æ‰§è¡Œ</td><td>${actualSpending.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</td></tr>
                                <tr><td style="font-weight:500;">å‰©ä½™é¢„ç®—</td><td>${remainingBudget.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</td></tr>
                            </tbody>
                           </table>`;

            html += `<h5 style="margin-top:20px; margin-bottom:10px; color: #764ba2;">å„ä¸»è¦ç±»åˆ«/éƒ¨é—¨é¢„ç®—æ‰§è¡Œæ˜ç»†</h5>`;
            html += `<table class="modal-table">
                            <thead>
                                <tr>
                                    <th>ç±»åˆ«/éƒ¨é—¨</th>
                                    <th>é¢„ç®—é¢</th>
                                    <th>å®é™…æ”¯å‡º</th>
                                    <th>æ‰§è¡Œç‡</th>
                                    <th>ç®€è¦è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody>`;

            breakdownData.forEach(item => {
                const executionRate = item.budget > 0 ? ((item.actual / item.budget) * 100).toFixed(1) : "0.0";
                html += `<tr>
                            <td>${item.name}</td>
                            <td>${item.budget.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</td>
                            <td>${item.actual.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</td>
                            <td>${executionRate}%</td>
                            <td><small>${item.note || '-'}</small></td>
                           </tr>`;
            });
             // Total row for breakdown
            const totalBreakdownBudget = breakdownData.reduce((sum, item) => sum + item.budget, 0);
            const totalBreakdownActual = breakdownData.reduce((sum, item) => sum + item.actual, 0);
            const overallBreakdownRate = totalBreakdownBudget > 0 ? ((totalBreakdownActual / totalBreakdownBudget) * 100).toFixed(1) : "0.0";

            html += `<tr class="total-row">
                            <td><strong>åˆè®¡</strong></td>
                            <td><strong>${totalBreakdownBudget.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</strong></td>
                            <td><strong>${totalBreakdownActual.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })}</strong></td>
                            <td><strong>${overallBreakdownRate}%</strong></td>
                            <td>-</td>
                           </tr>`;
            html += `</tbody></table>`;

            html += `<div class="policy-review-conclusion" style="margin-top:20px;">
                            <p><strong>æ™ºèƒ½åˆ†æä¸å»ºè®®:</strong></p>
                            <ul>
                                <li>æœ¬å­£åº¦é¢„ç®—æ•´ä½“æ‰§è¡Œæƒ…å†µè‰¯å¥½ï¼Œä¸è®¾å®šçš„ ${overallProgressPercent}% è¿›åº¦åŸºæœ¬å»åˆï¼Œè¡¨æ˜å…¬å¸æ•´ä½“è¿è¥æ”¯å‡ºåœ¨æ§åˆ¶ä¹‹ä¸­ã€‚</li>
                                <li>å¸‚åœºä¸è¿è¥éƒ¨é—¨é¢„ç®—ä½¿ç”¨å·²è¾¾è¾ƒé«˜æ°´å¹³ (åˆ†åˆ«ä¸º ${((breakdownData[1].actual/breakdownData[1].budget)*100).toFixed(1)}% å’Œ ${((breakdownData[0].actual/breakdownData[0].budget)*100).toFixed(1)}%)ï¼Œåç»­éœ€ä¸¥æ ¼æ§åˆ¶æ–°å¢éè®¡åˆ’æ”¯å‡ºã€‚</li>
                                <li>ç ”å‘éƒ¨é—¨æ‰§è¡Œç‡ä¸º ${((breakdownData[2].actual/breakdownData[2].budget)*100).toFixed(1)}%ï¼Œç¬¦åˆç¨³æ­¥æ¨è¿›çš„æ€åŠ¿ï¼Œè‹¥æœ‰é‡å¤§é‡Œç¨‹ç¢‘èŠ‚ç‚¹ï¼Œå¯é€‚åº¦åŠ å¿«æŠ•å…¥ã€‚</li>
                                <li>è¡Œæ”¿éƒ¨é—¨é¢„ç®—å°šæœ‰ ${((1 - (breakdownData[3].actual/breakdownData[3].budget))*100).toFixed(1)}% çš„ä½™é¢ï¼Œè´¢åŠ¡éƒ¨é—¨å¯ä¸è¡Œæ”¿ç¡®è®¤ä¸‹é˜¶æ®µå¤§é¢æ”¯å‡ºè®¡åˆ’ï¼Œä»¥ä¼˜åŒ–èµ„é‡‘åˆ©ç”¨æ•ˆç‡ã€‚</li>
                            </ul>
                            <p><strong>åç»­è¡ŒåŠ¨:</strong> å»ºè®®è´¢åŠ¡ç»ç†ä¸å„éƒ¨é—¨è´Ÿè´£äººå°±å‰©ä½™é¢„ç®—ä½¿ç”¨è®¡åˆ’è¿›è¡Œæ²Ÿé€šï¼Œç¡®ä¿å­£åº¦æœ«é¢„ç®—ç›®æ ‡çš„é¡ºåˆ©è¾¾æˆï¼Œå¹¶ä¸ºä¸‹å­£åº¦é¢„ç®—ç¼–åˆ¶æä¾›æ•°æ®æ”¯æŒã€‚</p>
                           </div>`;
            return html;
        }


        function showBudgetVarianceDetail(varianceType) {
            if(!budgetDetailedAnalysisSectionEl || !budgetAnalysisOutputEl) return;
            let title = "é¢„ç®—åå·®è¯¦æƒ…";
            let contentHtml = "";
            budgetDetailedAnalysisSectionEl.classList.remove('show'); // Hide first, then show
            budgetAnalysisOutputEl.innerHTML = ''; // Clear previous content


            if (varianceType === 'MarketPromoVariance') {
                title = "å¸‚åœºæ¨å¹¿è´¹è¶…é¢„ç®—åˆ†æ";
                contentHtml = `
                    <div class="automated-finding-card">
                        <div class="finding-header"><span class="icon">ğŸ’¸</span><span class="title">${title}</span><span class="priority-tag high">åå·®+30%</span></div>
                        <div class="finding-content">
                            <div class="finding-section">
                                <h6>é¢„ç®—å·®å¼‚è¯¦æƒ…</h6>
                                <p>â€¢ é¢„ç®—é‡‘é¢: <span class="key-data-highlight">500,000å…ƒ</span></p>
                                <p>â€¢ å®é™…å‘ç”Ÿ: <span class="key-data-highlight">650,000å…ƒ</span></p>
                                <p>â€¢ åå·®é‡‘é¢: <span class="important-note over">+150,000å…ƒ</span></p>
                                <p>â€¢ åå·®ç‡: <span class="important-note over">+30%</span></p>
                            </div>
                            <div class="finding-section">
                                <h6>è¯­ä¹‰åŒ–åå·®æç¤º:</h6>
                                <p><i>â€œå¸‚åœºæ¨å¹¿è´¹æœ¬æœˆè¶…é¢„ç®—30%ï¼Œæ˜¯å¦ç”±äºæœ¬æœˆä¸¾è¡Œäº†å¤§å‹å¸‚åœºæ´»åŠ¨ï¼Ÿâ€</i></p>
                            </div>
                            <div class="finding-section">
                                <h6>å¤šç»´åº¦æ•°æ®å…³è”åˆ†æ:</h6>
                                <ul>
                                    <li><strong>ã€ä¼ä¸šæ´»åŠ¨è®°å½•ã€‘</strong>å‘ç°5æœˆå¼€å±•äº†ä¸‰åœºçº¿ä¸‹æ¨å¹¿æ´»åŠ¨ï¼Œåˆè®¡è´¹ç”¨é¢„ä¼°çº¦60ä¸‡å…ƒã€‚</li>
                                    <li><strong>ã€å†…éƒ¨ç§‘ç›®æ•°æ®ã€‘</strong>çº¿ä¸ŠæŠ•æ”¾æ”¯å‡ºç¯æ¯”å¢é•¿45%ã€‚</li>
                                    <li><strong>ã€å¤–éƒ¨å› ç´ æ•°æ®ã€‘</strong>è¡Œä¸šè¿›å…¥å­£èŠ‚æ€§ä¿ƒé”€æœŸï¼Œç«äº‰å¯¹æ‰‹æ¨å¹¿æ´»åŠ¨å¢åŠ ã€‚</li>
                                </ul>
                            </div>
                             <div class="finding-section">
                                <h6>æ•°æ®é©±åŠ¨çš„åˆæ­¥è§£é‡Šæ¨¡å‹:</h6>
                                <p>ç»“åˆæœ¬æœˆä¼ä¸šæ´»åŠ¨è®°å½•ï¼Œç³»ç»Ÿå‘ç°å¸‚åœºéƒ¨äº5æœˆå¼€å±•äº†ä¸‰åœºçº¿ä¸‹æ¨å¹¿æ´»åŠ¨ï¼Œåˆè®¡è´¹ç”¨é¢„ä¼°åœ¨60ä¸‡å…ƒå·¦å³ï¼Œå¯èƒ½æ˜¯å¯¼è‡´è´¹ç”¨è¶…é¢„ç®—çš„ä¸»è¦åŸå› ã€‚åŒæ—¶è§‚å¯Ÿåˆ°çº¿ä¸ŠæŠ•æ”¾æ”¯å‡ºç¯æ¯”å¢é•¿45%ï¼Œè¿›ä¸€æ­¥åŠ å‰§è´¹ç”¨è¶…æ”¯ã€‚ç»“åˆè¡Œä¸šå­£èŠ‚æ€§ä¿ƒé”€æœŸå› ç´ ï¼Œè¡¨æ˜å¸‚åœºéƒ¨åœ¨æ­¤é˜¶æ®µåŠ å¤§äº†æ¨å¹¿åŠ›åº¦ã€‚</p>
                            </div>
                        </div>
                        <div class="finding-actions">
                            <a href="javascript:void(0);" class="action-button-sim" onclick="alert('æ¨¡æ‹Ÿæ“ä½œï¼šå·²è¦æ±‚å¸‚åœºéƒ¨æäº¤åå·®è¯´æ˜æŠ¥å‘Šã€‚')">è¦æ±‚æäº¤åå·®è¯´æ˜</a>
                            <a href="javascript:void(0);" class="action-button-sim secondary" onclick="showBudgetAdjustmentDecisionModal()">å®¡è®®é¢„ç®—è°ƒæ•´</a>
                        </div>
                    </div>
                    ${generateBudgetOverallSummaryPartialHtml()}
                `;
            } else if (varianceType === 'RnDVariance') {
                 title = "ç ”å‘æ”¯å‡ºä½äºé¢„ç®—åˆ†æ";
                 contentHtml = `<div class="automated-finding-card"><div class="finding-header"><span class="icon">ğŸ“‰</span><span class="title">${title}</span><span class="priority-tag medium">åå·®-15%</span></div><div class="finding-content"><div class="finding-section"><h6>é¢„ç®—å·®å¼‚è¯¦æƒ…</h6><p>â€¢ é¢„ç®—é‡‘é¢: <span class="key-data-highlight">800,000å…ƒ</span></p><p>â€¢ å®é™…å‘ç”Ÿ: <span class="key-data-highlight">680,000å…ƒ</span></p><p>â€¢ åå·®é‡‘é¢: <span class="important-note under">-120,000å…ƒ</span></p><p>â€¢ åå·®ç‡: <span class="important-note under">-15%</span></p></div> <div class="finding-section"><h6>AIåˆ†æ</h6><p>å¯èƒ½åŸå› åŒ…æ‹¬é¡¹ç›®å»¶æœŸã€æ‹›è˜æœªè¾¾é¢„æœŸæˆ–æˆæœ¬æ§åˆ¶å¾—å½“ã€‚å»ºè®®æ ¸å®é¡¹ç›®è¿›åº¦åŠèµ„æºåˆ†é…è®¡åˆ’ã€‚</p></div></div><div class="finding-actions"><a href="javascript:void(0);" class="action-button-sim">æŸ¥çœ‹é¡¹ç›®æ˜ç»†</a></div></div>`;
            } else if (varianceType === 'AdminVariance') {
                 title = "è¡Œæ”¿åŠå…¬è´¹è¶…é¢„ç®—åˆ†æ";
                 contentHtml = `<div class="automated-finding-card"><div class="finding-header"><span class="icon">ğŸ“</span><span class="title">${title}</span><span class="priority-tag medium">åå·®+12%</span></div><div class="finding-content"><div class="finding-section"><h6>é¢„ç®—å·®å¼‚è¯¦æƒ…</h6><p>â€¢ é¢„ç®—é‡‘é¢: <span class="key-data-highlight">200,000å…ƒ</span></p><p>â€¢ å®é™…å‘ç”Ÿ: <span class="key-data-highlight">224,000å…ƒ</span></p><p>â€¢ åå·®é‡‘é¢: <span class="important-note over">+24,000å…ƒ</span></p><p>â€¢ åå·®ç‡: <span class="important-note over">+12%</span></p></div> <div class="finding-section"><h6>AIåˆ†æ</h6><p>å¯èƒ½ç”±äºé‡‡è´­ä»·æ ¼ä¸Šæ¶¨æˆ–ä¸´æ—¶æ€§æ”¯å‡ºå¢åŠ ã€‚å»ºè®®å®¡æŸ¥å…·ä½“æ”¯å‡ºæ˜ç»†ã€‚</p></div></div><div class="finding-actions"><a href="javascript:void(0);" class="action-button-sim">å®¡æŸ¥æ”¯å‡ºæ˜ç»†</a></div></div>`;
            }
            budgetAnalysisOutputEl.innerHTML = contentHtml;
            budgetDetailedAnalysisSectionEl.classList.add('show');
            budgetDetailedAnalysisSectionEl.scrollIntoView({ behavior: 'smooth' });
        }

        function showOverBudgetItemsDetail() {
            if(!budgetDetailedAnalysisSectionEl || !budgetAnalysisOutputEl) return;
            budgetDetailedAnalysisSectionEl.classList.remove('show');
            budgetAnalysisOutputEl.innerHTML = '';
            const contentHtml = `
                <div class="automated-finding-card">
                    <div class="finding-header"><span class="icon">ğŸ“ˆ</span><span class="title">è¶…é¢„ç®—é¡¹ç›®åˆ—è¡¨ä¸åŸå› åˆ†æ</span><span class="priority-tag high">3ä¸ªé¡¹ç›®</span></div>
                    <div class="finding-content">
                        <div class="finding-section">
                            <h6>1. å¸‚åœºæ¨å¹¿è´¹ - æ˜¥å­£æ–°å“å‘å¸ƒä¼š</h6>
                            <p>â€¢ éƒ¨é—¨: å¸‚åœºéƒ¨</p>
                            <p>â€¢ é¢„ç®—: 200,000å…ƒ | å®é™…: 280,000å…ƒ | <strong class="important-note over">è¶…æ”¯: +80,000å…ƒ (+40%)</strong></p>
                            <p><strong>AIåŸå› åˆ†æ:</strong> æ´»åŠ¨è§„æ¨¡è¶…å‡ºé¢„æœŸï¼Œå¢åŠ äº†KOLåˆä½œç¯èŠ‚ï¼ˆè´¹ç”¨çº¦5ä¸‡å…ƒï¼‰ï¼›åª’ä½“å®£ä¼ å‘¨æœŸå»¶é•¿ï¼Œé¢å¤–æŠ•æ”¾æ•°å­—å¹¿å‘Šï¼ˆè´¹ç”¨çº¦3ä¸‡å…ƒï¼‰ã€‚</p>
                            <p><strong>å»ºè®®:</strong> å¯¹å¤§å‹æ´»åŠ¨é¢„ç®—è¿›è¡Œæ›´ç»†è‡´æ‹†åˆ†ï¼Œå»ºç«‹åº”æ€¥é¢„å¤‡é‡‘ã€‚è¯„ä¼°KOLåˆä½œROIã€‚</p>
                        </div>
                        <div class="finding-section">
                            <h6>2. å·®æ—…è´¹ - æµ·å¤–ä¸šåŠ¡æ‹“å±•</h6>
                            <p>â€¢ éƒ¨é—¨: é”€å”®éƒ¨</p>
                            <p>â€¢ é¢„ç®—: 150,000å…ƒ | å®é™…: 195,000å…ƒ | <strong class="important-note over">è¶…æ”¯: +45,000å…ƒ (+30%)</strong></p>
                            <p><strong>AIåŸå› åˆ†æ:</strong> å›½é™…æœºç¥¨ä»·æ ¼ä¸Šæ¶¨è¶…å‡ºé¢„æœŸï¼ˆçº¦2ä¸‡å…ƒï¼‰ï¼›å¢åŠ äº†é¢å¤–çš„å®¢æˆ·æ‹›å¾…ä¸ç¤¼å“è´¹ç”¨ï¼ˆçº¦2.5ä¸‡å…ƒï¼‰ã€‚</p>
                            <p><strong>å»ºè®®:</strong> å°½å¯èƒ½æå‰é¢„è®¢æœºç¥¨ï¼Œæ˜ç¡®å·®æ—…æ‹›å¾…æ ‡å‡†ä¸ä¸Šé™ã€‚</p>
                        </div>
                        <div class="finding-section">
                            <h6>3. è¡Œæ”¿åŠå…¬è´¹ - ITè®¾å¤‡é‡‡è´­</h6>
                             <p>â€¢ éƒ¨é—¨: è¡Œæ”¿éƒ¨</p>
                            <p>â€¢ é¢„ç®—: 50,000å…ƒ | å®é™…: 75,000å…ƒ | <strong class="important-note over">è¶…æ”¯: +25,000å…ƒ (+50%)</strong></p>
                            <p><strong>AIåŸå› åˆ†æ:</strong> é‡‡è´­äº†æ›´é«˜é…ç½®çš„æœåŠ¡å™¨ä»¥æ»¡è¶³æœªæ¥éœ€æ±‚ï¼ˆçº¦1.5ä¸‡å…ƒè¶…æ”¯ï¼‰ï¼›å¢åŠ äº†ç´§æ€¥é‡‡è´­çš„åŠå…¬è½¯ä»¶æˆæƒï¼ˆçº¦1ä¸‡å…ƒï¼‰ã€‚</p>
                            <p><strong>å»ºè®®:</strong> ITè®¾å¤‡å‡çº§åº”æœ‰å‰ç»æ€§è§„åˆ’å¹¶çº³å…¥å¹´åº¦é¢„ç®—ï¼Œé¿å…ä¸´æ—¶é«˜ä»·é‡‡è´­ã€‚è½¯ä»¶æˆæƒé›†ä¸­é‡‡è´­ã€‚</p>
                        </div>
                         <div class="finding-section">
                            <h6>æ€»ä½“ç®¡ç†å»ºè®®</h6>
                            <p>â€¢ åŠ å¼ºé¢„ç®—ç¼–åˆ¶çš„é¢—ç²’åº¦å’Œå‰ç»æ€§ï¼Œå¯¹ä¸å¯æ§å› ç´ ï¼ˆå¦‚ä»·æ ¼æ³¢åŠ¨ï¼‰è®¾ç½®åˆç†æµ®åŠ¨èŒƒå›´ã€‚</p>
                            <p>â€¢ ä¸¥æ ¼æ‰§è¡Œé¢„ç®—å®¡æ‰¹æµç¨‹ï¼Œè¶…é¢„ç®—æ”¯å‡ºéœ€æœ‰å……åˆ†ç†ç”±å¹¶é€šè¿‡è¿½åŠ é¢„ç®—ç”³è¯·ã€‚</p>
                            <p>â€¢ å®šæœŸå¤ç›˜é¢„ç®—æ‰§è¡Œæƒ…å†µï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥ï¼Œé¿å…åå·®æŒç»­æ‰©å¤§ã€‚</p>
                        </div>
                    </div>
                    <div class="finding-actions">
                        <a href="javascript:void(0);" class="action-button-sim" onclick="alert('å·²é€šçŸ¥ç›¸å…³éƒ¨é—¨è´Ÿè´£äººæäº¤è¯¦ç»†æ•´æ”¹æŠ¥å‘Šã€‚')">è¦æ±‚éƒ¨é—¨æäº¤æ•´æ”¹æŠ¥å‘Š</a>
                        <a href="javascript:void(0);" class="action-button-sim secondary" onclick="openModal('æ±‡æ€»æŠ¥å‘Šä¸‹è½½', '<p>è¶…é¢„ç®—é¡¹ç›®æ±‡æ€»åˆ†ææŠ¥å‘Š (PDF) æ­£åœ¨ç”Ÿæˆ...</p><p>è¯·ç¨ååœ¨æ­¤å¤„ä¸‹è½½ã€‚</p>')">ä¸‹è½½æ±‡æ€»æŠ¥å‘Š</a>
                    </div>
                </div>`;
            budgetAnalysisOutputEl.innerHTML = contentHtml;
            budgetDetailedAnalysisSectionEl.classList.add('show');
            budgetDetailedAnalysisSectionEl.scrollIntoView({ behavior: 'smooth' });
        }

        function showUnderBudgetItemsDetail() {
            if(!budgetDetailedAnalysisSectionEl || !budgetAnalysisOutputEl) return;
            budgetDetailedAnalysisSectionEl.classList.remove('show');
            budgetAnalysisOutputEl.innerHTML = '';
            const contentHtml = `
                <div class="automated-finding-card">
                    <div class="finding-header"><span class="icon">ğŸ“‰</span><span class="title">æœªè¾¾é¢„ç®—é¡¹ç›®åˆ—è¡¨ä¸åŸå› åˆ†æ</span><span class="priority-tag medium">2ä¸ªé¡¹ç›®</span></div>
                    <div class="finding-content">
                        <div class="finding-section">
                            <h6>1. ç ”å‘è´¹ç”¨ - æ–°äº§å“Alphaçº¿</h6>
                            <p>â€¢ éƒ¨é—¨: ç ”å‘éƒ¨</p>
                            <p>â€¢ é¢„ç®—: 800,000å…ƒ | å®é™…: 680,000å…ƒ | <strong class="important-note under">èŠ‚ä½™/æœªè¾¾: -120,000å…ƒ (-15%)</strong></p>
                            <p><strong>AIåŸå› åˆ†æ:</strong> é¡¹ç›®éƒ¨åˆ†é˜¶æ®µæ€§ç›®æ ‡æå‰å®Œæˆï¼Œéƒ¨åˆ†æ¨¡å—é‡‡ç”¨ç°æœ‰æˆç†ŸæŠ€æœ¯æ–¹æ¡ˆæ›¿ä»£ï¼Œé™ä½äº†å¼€å‘æˆæœ¬ï¼›éƒ¨åˆ†é¢„è˜é«˜çº§å·¥ç¨‹å¸ˆå»¶è¿Ÿåˆ°å²—ï¼Œç›¸åº”äººåŠ›æˆæœ¬æœªè¶³é¢å‘ç”Ÿã€‚</p>
                            <p><strong>å»ºè®®:</strong> è¯„ä¼°é¡¹ç›®è¿›åº¦æ˜¯å¦ä»æŒ‰è®¡åˆ’æ¨è¿›ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨èµ„æºæŠ•å…¥ä¸è¶³çš„é£é™©ã€‚è‹¥ä¸ºæ•ˆç‡æå‡æ‰€è‡´ï¼Œå¯è€ƒè™‘å°†èŠ‚ä½™èµ„é‡‘è°ƒé…è‡³å…¶ä»–é‡ç‚¹é¡¹ç›®æˆ–è¿›è¡Œæ¿€åŠ±ã€‚</p>
                        </div>
                        <div class="finding-section">
                            <h6>2. åŸ¹è®­è´¹ç”¨ - å‘˜å·¥æŠ€èƒ½æå‡</h6>
                            <p>â€¢ éƒ¨é—¨: äººåŠ›èµ„æºéƒ¨</p>
                            <p>â€¢ é¢„ç®—: 100,000å…ƒ | å®é™…: 70,000å…ƒ | <strong class="important-note under">èŠ‚ä½™/æœªè¾¾: -30,000å…ƒ (-30%)</strong></p>
                            <p><strong>AIåŸå› åˆ†æ:</strong> åŸè®¡åˆ’çš„å¤–éƒ¨è®²å¸ˆåŸ¹è®­è¯¾ç¨‹å› æ•…å–æ¶ˆï¼Œæ”¹ä¸ºå†…éƒ¨ç»éªŒåˆ†äº«ä¼šï¼Œå¤§å¹…é™ä½æˆæœ¬ï¼›éƒ¨åˆ†å‘˜å·¥å› é¡¹ç›®ç¹å¿™æœªèƒ½å‚åŠ å·²å®‰æ’çš„åŸ¹è®­ã€‚</p>
                            <p><strong>å»ºè®®:</strong> è·Ÿè¸ªå‘˜å·¥åŸ¹è®­å®Œæˆç‡ï¼Œç¡®ä¿æ ¸å¿ƒæŠ€èƒ½åŸ¹è®­å¾—åˆ°è½å®ã€‚è¯„ä¼°å–æ¶ˆå¤–éƒ¨åŸ¹è®­å¯¹åŸ¹è®­è´¨é‡çš„é•¿æœŸå½±å“ã€‚</p>
                        </div>
                        <div class="finding-section">
                            <h6>æ€»ä½“ç®¡ç†å»ºè®®</h6>
                            <p>â€¢ å¯¹äºæœªè¾¾é¢„ç®—é¡¹ç›®ï¼Œéœ€åŒºåˆ†æ˜¯æ•ˆç‡æå‡ã€æˆæœ¬ä¼˜åŒ–ï¼Œè¿˜æ˜¯è®¡åˆ’æ‰§è¡Œä¸åˆ°ä½ã€èµ„æºæŠ•å…¥ä¸è¶³ã€‚</p>
                            <p>â€¢ è‹¥å› è®¡åˆ’æ¨è¿Ÿæˆ–å–æ¶ˆå¯¼è‡´é¢„ç®—èŠ‚ä½™ï¼Œåº”è¯„ä¼°å¯¹ä¸šåŠ¡ç›®æ ‡çš„æ½œåœ¨å½±å“ã€‚</p>
                            <p>â€¢ é¼“åŠ±æˆæœ¬èŠ‚çº¦ï¼Œä½†éœ€ç¡®ä¿ä¸å½±å“æ ¸å¿ƒä¸šåŠ¡çš„æ­£å¸¸å¼€å±•å’Œé•¿æœŸå‘å±•ã€‚</p>
                        </div>
                    </div>
                     <div class="finding-actions">
                        <a href="javascript:void(0);" class="action-button-sim" onclick="alert('å·²è¦æ±‚ç›¸å…³éƒ¨é—¨è´Ÿè´£äººç¡®è®¤é¡¹ç›®è¿›åº¦åŠèµ„æºéœ€æ±‚ã€‚')">è¦æ±‚éƒ¨é—¨ç¡®è®¤è¿›åº¦</a>
                        <a href="javascript:void(0);" class="action-button-sim secondary" onclick="openModal('æ±‡æ€»æŠ¥å‘Šä¸‹è½½', '<p>æœªè¾¾é¢„ç®—é¡¹ç›®æƒ…å†µæŠ¥å‘Š (PDF) æ­£åœ¨ç”Ÿæˆ...</p><p>è¯·ç¨ååœ¨æ­¤å¤„ä¸‹è½½ã€‚</p>')">ä¸‹è½½æ±‡æ€»æŠ¥å‘Š</a>
                    </div>
                </div>`;
            budgetAnalysisOutputEl.innerHTML = contentHtml;
            budgetDetailedAnalysisSectionEl.classList.add('show');
            budgetDetailedAnalysisSectionEl.scrollIntoView({ behavior: 'smooth' });
        }


        function generateBudgetOverallSummaryPartialHtml() {
            // Based on 4.jpg
            return `
            <div class="automated-finding-card" style="margin-top:20px;">
                <div class="finding-header"><span class="icon">ğŸ“Š</span><span class="title">é¢„ç®—åå·®åˆ†ææ€»ç»“ä¸å†³ç­–</span></div>
                <div class="finding-content">
                    <div class="finding-section">
                        <h6>é¢„ç®—åå·®åˆ†ææ€»ç»“</h6>
                        <p>ç³»ç»Ÿå·²å®Œæˆå¯¹å„éƒ¨é—¨é¢„ç®—æ‰§è¡Œæƒ…å†µçš„å…¨é¢åˆ†æï¼Œå‘ç°3ä¸ªè¶…å‡ºé¢„ç®—é˜ˆå€¼çš„é¡¹ç›®å’Œ2ä¸ªæœªè¾¾é¢„ç®—ç›®æ ‡çš„é¡¹ç›®ã€‚é‡ç‚¹å…³æ³¨ï¼šå¸‚åœºæ¨å¹¿è´¹è¶…å‡ºé¢„ç®—30%ï¼Œé€šè¿‡å¤šç»´åº¦æ•°æ®åˆ†æï¼Œåˆ¤æ–­åŸå› ä¸º5æœˆä¸´æ—¶å®‰æ’çš„ä¸‰åœºçº¿ä¸‹æ¨å¹¿æ´»åŠ¨åŠçº¿ä¸ŠæŠ•æ”¾å¢åŠ ï¼Œç»“åˆè¡Œä¸šå­£èŠ‚æ€§å› ç´ ã€‚å»ºè®®å¸‚åœºéƒ¨è¯¦ç»†è¯´æ˜æŠ•å…¥äº§å‡ºæ¯”ï¼Œå¹¶å®¡è®®è°ƒæ•´åç»­é¢„ç®—å®‰æ’ã€‚</p>
                    </div>
                    <div class="finding-section">
                         <h6>é¢„ç®—è°ƒæ•´å†³ç­–</h6>
                         <p>ä¸ºå¸‚åœºéƒ¨è¿½åŠ é¢„ç®— <span class="key-data-highlight">150,000å…ƒ</span>ï¼Œä»¥æ”¯æŒå·²å¼€å±•æ´»åŠ¨ã€‚</p>
                         <div class="finding-actions" style="border-top:none; padding-top:10px;">
                            <a href="javascript:void(0);" class="action-button-sim" onclick="alert('ä¸´æ—¶é¢„ç®—å·²å®¡æ‰¹å¹¶è°ƒæ•´ã€‚')">å®¡æ‰¹å¹¶è°ƒæ•´é¢„ç®—</a>
                            <a href="javascript:void(0);" class="action-button-sim secondary" onclick="alert('å·²å‘é€ç”³è¯·å•ç»™å¸‚åœºéƒ¨ï¼Œè¦æ±‚è¡¥å……åå·®è¯´æ˜ã€‚')">è¦æ±‚éƒ¨é—¨æäº¤åå·®è¯´æ˜</a>
                         </div>
                         <h6 style="margin-top:15px;">è°ƒæ•´å®¡æ‰¹æµç¨‹</h6>
                         <p>ä¿®æ”¹å¸‚åœºè´¹ç”¨å®¡æ‰¹æµç¨‹ï¼Œè¶…è¿‡ <span class="key-data-highlight">Â±10%</span> çš„é¢„ç®—è°ƒæ•´éœ€ä¸ŠæŠ¥è‡³è´¢åŠ¡æ€»ç›‘ã€‚</p>
                         <div class="finding-actions" style="border-top:none; padding-top:10px;">
                              <a href="javascript:void(0);" class="action-button-sim" onclick="alert('å®¡æ‰¹æµç¨‹è§„åˆ™å·²æ›´æ–°ã€‚')">æ›´æ–°æµç¨‹è§„åˆ™</a>
                         </div>
                    </div>
                     <div class="finding-section">
                        <h6>é¢„ç®—è¶‹åŠ¿é¢„æµ‹</h6>
                        <div class="trend-chart-placeholder"></div>
                        <p style="text-align:center; font-size:0.9em; margin-top:5px;">é¢„æµ‹ï¼šæ ¹æ®å½“å‰è¶‹åŠ¿ï¼Œæœªæ¥ä¸¤ä¸ªæœˆå¸‚åœºè´¹ç”¨å°†é€æ­¥å›å½’é¢„ç®—æ°´å¹³ã€‚</p>
                    </div>
                </div>
            </div>
            `;
        }
        function showBudgetAdjustmentDecisionModal() { // Renamed to avoid conflict
            const decisionContent = `
                <h4>é¢„ç®—è°ƒæ•´å†³ç­– (å¸‚åœºæ¨å¹¿è´¹)</h4>
                <p>å½“å‰åå·®ï¼š+150,000å…ƒ (+30%)</p>
                <p>å»ºè®®è¡ŒåŠ¨ï¼š</p>
                <ul>
                    <li><strong>æ‰¹å‡†ä¸´æ—¶é¢„ç®—è°ƒæ•´ï¼š</strong>åŒæ„è¿½åŠ 150,000å…ƒä»¥è¦†ç›–å·²å‘ç”Ÿè´¹ç”¨ã€‚</li>
                    <li><strong>è¦æ±‚éƒ¨é—¨è¯´æ˜ï¼š</strong>å¸‚åœºéƒ¨éœ€æäº¤è¯¦ç»†çš„æ´»åŠ¨æ•ˆæœåŠè¶…æ”¯åŸå› æŠ¥å‘Šã€‚</li>
                    <li><strong>è°ƒæ•´å®¡æ‰¹æµç¨‹ï¼š</strong>è€ƒè™‘å°†å¸‚åœºæ¨å¹¿è´¹çš„é‡å¤§è°ƒæ•´å®¡æ‰¹æƒé™ä¸Šç§»ã€‚</li>
                </ul>
                <div class="finding-actions">
                     <a href="javascript:void(0);" class="action-button-sim" onclick="alert('ä¸´æ—¶é¢„ç®—è°ƒæ•´å·²æäº¤å®¡æ‰¹ã€‚'); closeModal();">æäº¤é¢„ç®—è°ƒæ•´å®¡æ‰¹</a>
                     <a href="javascript:void(0);" class="action-button-sim secondary" onclick="alert('å·²é€šçŸ¥å¸‚åœºéƒ¨è¡¥å……è¯´æ˜ã€‚'); closeModal();">é€šçŸ¥å¸‚åœºéƒ¨è¡¥å……è¯´æ˜</a>
                </div>`;
            openModal("é¢„ç®—è°ƒæ•´å†³ç­–", decisionContent);
        }

        // --- International Version Page Logic ---
        const entitySelect = document.getElementById('entitySelect');
        const dispEntityName = document.getElementById('dispEntityName');
        const dispAccountingStandard = document.getElementById('dispAccountingStandard');
        const dispReportingCurrency = document.getElementById('dispReportingCurrency');
        const entitySpecificRulesText = document.getElementById('entitySpecificRulesText');
        const selectedStandardLib = document.getElementById('selectedStandardLib');
        const standardSpecificPointsList = document.getElementById('standardSpecificPointsList');
        const sourceCurrencyDisplay = document.getElementById('sourceCurrencyDisplay');
        const exchangeRateInput = document.getElementById('exchangeRateInput');
        const inputRateFromCurrency = document.getElementById('inputRateFromCurrency');
        const inputRateToCurrency = document.getElementById('inputRateToCurrency');
        const simulateConversionBtn = document.getElementById('simulateConversionBtn');
        const conversionResultDisplay = document.getElementById('conversionResultDisplay');
        const currencyConversionSection = document.getElementById('currencyConversionSection');


        const mockEntitiesData = {
            entityA: {
                name: "å­å…¬å¸A (ä¸­å›½, CAS, CNY)",
                standard: "ä¸­å›½ä¼šè®¡å‡†åˆ™ (CAS)",
                standardShort: "CAS",
                currency: "äººæ°‘å¸ (CNY)",
                currencyShort: "CNY",
                groupCurrency: "CNY",
                rulesText: "å­å…¬å¸A: å¯ç”¨ä¸­å›½ç‰¹è‰²å¢å€¼ç¨ç›¸å…³å®¡æ ¸è§„åˆ™ï¼Œå…³æ³¨ç ”å‘è´¹ç”¨åŠ è®¡æ‰£é™¤åˆè§„æ€§ï¼Œæ£€æŸ¥ä¸‰å…¬ç»è´¹æ ‡å‡†ã€‚",
                standardLib: "ä¸­å›½ä¼šè®¡å‡†åˆ™ (CAS) è§„åˆ™é›†",
                standardPoints: [
                    "å›ºå®šèµ„äº§æŠ˜æ—§å¹´é™ä¸æ®‹å€¼ç‡ç¬¦åˆCASè§„å®šã€‚",
                    "æ”¶å…¥ç¡®è®¤æ»¡è¶³CASæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯å»ºé€ åˆåŒã€åˆ†æœŸæ”¶æ¬¾é”€å”®ç­‰ç‰¹æ®Šä¸šåŠ¡çš„æ”¶å…¥ç¡®è®¤æ–¹æ³•ã€‚",
                    "æ”¿åºœè¡¥åŠ©çš„ä¼šè®¡å¤„ç†ç¬¦åˆCASè¦æ±‚ã€‚",
                    "èµ„äº§å‡å€¼å‡†å¤‡è®¡æçš„å……åˆ†æ€§ä¸å‡†ç¡®æ€§ã€‚"
                ],
                coaMapping: [
                    { localCode: "1001", localName: "åº“å­˜ç°é‡‘", groupCode: "G-1001", groupName: "Cash on Hand" },
                    { localCode: "1002", localName: "é“¶è¡Œå­˜æ¬¾", groupCode: "G-1002", groupName: "Cash in Bank" },
                    { localCode: "1122", localName: "åº”æ”¶è´¦æ¬¾", groupCode: "G-1100", groupName: "Accounts Receivable" },
                    { localCode: "1403", localName: "åŸææ–™", groupCode: "G-1301", groupName: "Raw Materials Inventory" },
                    { localCode: "6001", localName: "ä¸»è¥ä¸šåŠ¡æ”¶å…¥", groupCode: "G-4001", groupName: "Operating Revenue" }
                ],
                sampleAccounts: [ {name: "è¥ä¸šæ”¶å…¥", amount: 150000000}, {name: "ç®¡ç†è´¹ç”¨", amount: 7000000}]
            },
            entityB: {
                name: "Subsidiary B (USA, IFRS, USD)",
                standard: "å›½é™…è´¢åŠ¡æŠ¥å‘Šå‡†åˆ™ (IFRS)",
                standardShort: "IFRS",
                currency: "ç¾å…ƒ (USD)",
                currencyShort: "USD",
                groupCurrency: "CNY", // Assuming group consolidates in CNY
                rulesText: "Subsidiary B: Apply IFRS 15 for revenue from contracts with customers, especially for software licenses. IFRS 16 for lease accounting.",
                standardLib: "å›½é™…è´¢åŠ¡æŠ¥å‘Šå‡†åˆ™ (IFRS) è§„åˆ™é›†",
                standardPoints: [
                    "Revenue recognition in accordance with IFRS 15 (5-step model).",
                    "Lease accounting for right-of-use assets and lease liabilities under IFRS 16.",
                    "Financial instrument classification and measurement (IFRS 9).",
                    "Impairment of assets under IAS 36."
                ],
                coaMapping: [
                    { localCode: "CASH-EQ", localName: "Cash and Equivalents", groupCode: "G-1000", groupName: "Cash & Bank Balances" },
                    { localCode: "AR-TRADE", localName: "Trade Receivables", groupCode: "G-1100", groupName: "Accounts Receivable" },
                    { localCode: "INV-RAW", localName: "Inventory - Raw Materials", groupCode: "G-1301", groupName: "Raw Materials Inventory" },
                    { localCode: "SALES-REV", localName: "Sales Revenue", groupCode: "G-4001", groupName: "Operating Revenue" },
                    { localCode: "OPEX-RENT", localName: "Operating Expenses - Rent", groupCode: "G-5105", groupName: "Rent Expense" }
                ],
                sampleAccounts: [ {name: "Sales Revenue", amount: 20000000}, {name: "Operating Expenses", amount: 1200000}],
                defaultRate: 7.10 // USD to CNY
            },
            entityC: {
                name: "Branch C (Europe, IFRS, EUR)",
                standard: "å›½é™…è´¢åŠ¡æŠ¥å‘Šå‡†åˆ™ (IFRS)",
                standardShort: "IFRS",
                currency: "æ¬§å…ƒ (EUR)",
                currencyShort: "EUR",
                groupCurrency: "CNY",
                rulesText: "Branch C: Focus on IFRS 9 for financial instruments, particularly hedging. VAT reconciliation for intra-community supplies.",
                standardLib: "å›½é™…è´¢åŠ¡æŠ¥å‘Šå‡†åˆ™ (IFRS) è§„åˆ™é›†",
                standardPoints: [
                    "Hedge accounting effectiveness testing (IFRS 9).",
                    "Deferred tax assets/liabilities calculation under IAS 12.",
                    "Provisions, contingent liabilities and contingent assets (IAS 37).",
                    "Compliance with local tax regulations alongside IFRS."
                ],
                coaMapping: [
                    { localCode: "BANK-EUR", localName: "Bank Account EUR", groupCode: "G-1002", groupName: "Cash in Bank" },
                    { localCode: "REC-CLIENTS", localName: "Receivables Clients EU", groupCode: "G-1100", groupName: "Accounts Receivable" },
                    { localCode: "STOCK-FG", localName: "Stock Finished Goods", groupCode: "G-1303", groupName: "Finished Goods Inventory" },
                    { localCode: "TURN-EU", localName: "Turnover EU Market", groupCode: "G-4001", groupName: "Operating Revenue" }
                ],
                sampleAccounts: [ {name: "Turnover", amount: 15000000}, {name: "Personnel Costs", amount: 3000000}],
                defaultRate: 7.80 // EUR to CNY
            }
        };

        function resetInternationalVersionDemo() {
            if(entitySelect) entitySelect.value = 'entityA'; // Default to entity A
            updateInternationalPageContent('entityA');
            if(conversionResultDisplay) conversionResultDisplay.innerHTML = '';
            closeModal();
        }


        function updateInternationalPageContent(entityKey) {
            const entityData = mockEntitiesData[entityKey];
            if (!entityData || !dispEntityName || !dispAccountingStandard || !dispReportingCurrency || !entitySpecificRulesText || !selectedStandardLib || !standardSpecificPointsList || !sourceCurrencyDisplay || !exchangeRateInput || !simulateConversionBtn || !inputRateFromCurrency || !inputRateToCurrency || !currencyConversionSection) {
                console.error("One or more International Page elements are missing.");
                return;
            }

            dispEntityName.textContent = entityData.name;
            dispAccountingStandard.textContent = entityData.standard;
            dispReportingCurrency.textContent = entityData.currency;
            entitySpecificRulesText.textContent = entityData.rulesText;
            selectedStandardLib.textContent = entityData.standardLib;

            standardSpecificPointsList.innerHTML = '';
            entityData.standardPoints.forEach(point => {
                const li = document.createElement('li');
                li.textContent = point;
                standardSpecificPointsList.appendChild(li);
            });

            sourceCurrencyDisplay.textContent = entityData.currency;

            if (entityData.currencyShort === entityData.groupCurrency) {
                 currencyConversionSection.style.display = 'none';
            } else {
                currencyConversionSection.style.display = 'block';
                inputRateFromCurrency.textContent = entityData.currencyShort;
                inputRateToCurrency.textContent = entityData.groupCurrency;
                exchangeRateInput.value = entityData.defaultRate || '';
                exchangeRateInput.disabled = false;
                simulateConversionBtn.disabled = false;
            }
            if(conversionResultDisplay) conversionResultDisplay.innerHTML = '';
        }

        function initializeInternationalPage() {
            if(entitySelect) {
                entitySelect.addEventListener('change', function() {
                    updateInternationalPageContent(this.value);
                });
                // Initial call to populate content based on default selection
                updateInternationalPageContent(entitySelect.value);
            }

            const viewCoaMappingBtn = document.getElementById('viewCoaMappingBtn');
            if(viewCoaMappingBtn) viewCoaMappingBtn.addEventListener('click', () => {
                const currentEntityKey = entitySelect.value;
                const entityData = mockEntitiesData[currentEntityKey];
                let modalHtml = `<h4>ç§‘ç›®æ˜ å°„è¡¨: ${entityData.name} (ç¤ºä¾‹)</h4>`;
                modalHtml += `<p>å°† ${entityData.currencyShort} æœ¬åœ°ç§‘ç›®æ˜ å°„è‡³é›†å›¢ç»Ÿä¸€ç§‘ç›® (${entityData.groupCurrency})</p>`;
                modalHtml += `<table class="modal-table"><thead><tr><th>æœ¬åœ°ç§‘ç›®ä»£ç </th><th>æœ¬åœ°ç§‘ç›®åç§°</th><th>é›†å›¢ç§‘ç›®ä»£ç </th><th>é›†å›¢ç§‘ç›®åç§°</th></tr></thead><tbody>`;
                entityData.coaMapping.forEach(map => {
                    modalHtml += `<tr><td>${map.localCode}</td><td>${map.localName}</td><td>${map.groupCode}</td><td>${map.groupName}</td></tr>`;
                });
                modalHtml += `</tbody></table>`;
                modalHtml += `<p style="margin-top:10px; font-size:0.9em;"><strong>è¯´æ˜:</strong> æ­¤ä¸ºç®€åŒ–ç¤ºä¾‹ã€‚å®é™…ç³»ç»Ÿä¸­ï¼Œæ˜ å°„è§„åˆ™å°†æ›´å¤æ‚ï¼Œæ”¯æŒå¤šå¯¹ä¸€ã€æ¡ä»¶æ˜ å°„ï¼Œå¹¶å¯é€šè¿‡å›¾å½¢åŒ–ç•Œé¢é…ç½®æˆ–Excelå¯¼å…¥/å¯¼å‡ºã€‚</p>`;
                openModal('ç§‘ç›®æ˜ å°„è¡¨ç¤ºä¾‹ (COA Mapping Example)', modalHtml);
            });

            if(simulateConversionBtn) simulateConversionBtn.addEventListener('click', () => {
                const currentEntityKey = entitySelect.value;
                const entityData = mockEntitiesData[currentEntityKey];
                const rate = parseFloat(exchangeRateInput.value);

                if (!rate || rate <= 0) {
                    conversionResultDisplay.innerHTML = '<p style="color:red;">è¯·è¾“å…¥æœ‰æ•ˆçš„æ±‡ç‡ã€‚</p>';
                    return;
                }
                let resultsHtml = `<p>æŒ‰æ±‡ç‡ 1 ${entityData.currencyShort} = ${rate.toFixed(4)} ${entityData.groupCurrency} æŠ˜ç®—:</p>`;
                resultsHtml += `<table class="modal-table" style="margin-top:5px;"><thead><tr><th>ç§‘ç›®</th><th>åŸå¸é‡‘é¢ (${entityData.currencyShort})</th><th>æŠ˜ç®—åé‡‘é¢ (${entityData.groupCurrency})</th></tr></thead><tbody>`;
                entityData.sampleAccounts.forEach(acc => {
                    resultsHtml += `<tr><td>${acc.name}</td><td>${acc.amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td><td>${(acc.amount * rate).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td></tr>`;
                });
                resultsHtml += `</tbody></table>`;
                conversionResultDisplay.innerHTML = resultsHtml;
            });

            const manageEntityConfigBtn = document.getElementById('manageEntityConfigBtn');
            if(manageEntityConfigBtn) manageEntityConfigBtn.addEventListener('click', () => {
                const currentEntityKey = entitySelect.value;
                const entityData = mockEntitiesData[currentEntityKey];
                let modalHtml = `<h4>ç®¡ç†å®ä½“é…ç½®: ${entityData.name} (æ¨¡æ‹Ÿ)</h4>`;
                modalHtml += `<div class="form-group"><label for="confEntityName">å®ä½“åç§°:</label><input type="text" id="confEntityName" value="${entityData.name}" readonly></div>`;
                modalHtml += `<div class="form-group"><label for="confAccStandard">ä¼šè®¡å‡†åˆ™:</label><select id="confAccStandard"><option value="CAS" ${entityData.standardShort === 'CAS' ? 'selected' : ''}>ä¸­å›½ä¼šè®¡å‡†åˆ™ (CAS)</option><option value="IFRS" ${entityData.standardShort === 'IFRS' ? 'selected' : ''}>å›½é™…è´¢åŠ¡æŠ¥å‘Šå‡†åˆ™ (IFRS)</option></select></div>`;
                modalHtml += `<div class="form-group"><label for="confRepCurrency">æŠ¥å‘Šå¸ç§:</label><select id="confRepCurrency"><option value="CNY" ${entityData.currencyShort === 'CNY' ? 'selected' : ''}>äººæ°‘å¸ (CNY)</option><option value="USD" ${entityData.currencyShort === 'USD' ? 'selected' : ''}>ç¾å…ƒ (USD)</option><option value="EUR" ${entityData.currencyShort === 'EUR' ? 'selected' : ''}>æ¬§å…ƒ (EUR)</option></select></div>`;
                modalHtml += `<div class="form-group"><label for="confCoaTemplate">ç§‘ç›®è¡¨æ¨¡æ¿:</label><select id="confCoaTemplate"><option>é›†å›¢æ ‡å‡†ç§‘ç›®è¡¨</option><option selected>${entityData.standardShort} æœ¬åœ°åŒ–ç§‘ç›®è¡¨</option><option>è‡ªå®šä¹‰æ¨¡æ¿XYZ</option></select></div>`;
                modalHtml += `<div class="form-group"><label for="confBudgetTolerance">é¢„ç®—å®¹å·®æ¯”ä¾‹ (%):</label><input type="number" id="confBudgetTolerance" value="10"></div>`;
                modalHtml += `<div class="form-group"><label>å¯ç”¨è§„åˆ™é›†:</label><div><input type="checkbox" id="ruleGeneral" checked> <label for="ruleGeneral" style="display:inline;">é€šç”¨è´¢åŠ¡è§„åˆ™</label></div><div><input type="checkbox" id="ruleTax" ${entityData.standardShort === 'CAS' ? 'checked' : ''}> <label for="ruleTax" style="display:inline;">ç¨åŠ¡åˆè§„è§„åˆ™</label></div><div><input type="checkbox" id="ruleIndustry"> <label for="ruleIndustry" style="display:inline;">è¡Œä¸šç‰¹å®šè§„åˆ™</label></div></div>`;
                modalHtml += `<div class="form-group"><label for="confConsolCurrency">ç»Ÿä¸€æŠ˜ç®—å¸ç§:</label><select id="confConsolCurrency"><option value="CNY" ${entityData.groupCurrency === 'CNY' ? 'selected' : ''}>äººæ°‘å¸ (CNY)</option><option value="USD" ${entityData.groupCurrency === 'USD' ? 'selected' : ''}>ç¾å…ƒ (USD)</option></select></div>`;
                modalHtml += `<p style="font-size:0.9em; margin-top:15px;">ç³»ç»Ÿæ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æˆ–å¯è§†åŒ–ç•Œé¢ä¸ºæ¯ä¸ªå•ä½è®¾ç½®ç‹¬ç«‹çš„å®¡æ ¸å‚æ•°ã€‚é…ç½®é‡‡ç”¨å‘å¯¼å¼å¼•å¯¼æµç¨‹ï¼Œæ–°å¢å•ä½ä¾¿æ·é«˜æ•ˆã€‚</p>`;
                modalHtml += `<div class="finding-actions" style="margin-top:20px;"><button class="action-button-sim" onclick="alert('é…ç½®å·²ä¿å­˜ (æ¨¡æ‹Ÿ)'); closeModal();">ä¿å­˜é…ç½®</button></div>`;
                openModal('ç®¡ç†å®ä½“é…ç½® (æ¨¡æ‹Ÿ)', modalHtml);
            });

            const newEntityWizardBtn = document.getElementById('newEntityWizardBtn');
            if(newEntityWizardBtn) newEntityWizardBtn.addEventListener('click', () => {
                let modalHtml = `<h4>æ–°å¢å•ä½å‘å¯¼ (æ¨¡æ‹Ÿ)</h4>`;
                modalHtml += `<p>é€šè¿‡ç®€å•å‡ æ­¥ï¼Œå¿«é€Ÿå®Œæˆæ–°å•ä½çš„æ¥å…¥å’Œå®¡æ ¸ç¯å¢ƒåˆå§‹åŒ–ã€‚</p>`;
                modalHtml += `<div class="form-group" style="margin-top:15px;"><label>æ­¥éª¤1: è¾“å…¥å•ä½åŸºæœ¬ä¿¡æ¯</label><input type="text" placeholder="æ–°å•ä½åç§°, e.g., å­å…¬å¸D (æ–°åŠ å¡)"></div>`;
                modalHtml += `<div class="form-group"><label>æ­¥éª¤2: é€‰æ‹©ä¼šè®¡å‡†åˆ™ä¸æŠ¥å‘Šå¸ç§</label><select><option>IFRS</option><option>CAS</option><option>US GAAP</option></select> <select><option>SGD</option><option>USD</option><option>CNY</option></select></div>`;
                modalHtml += `<div class="form-group"><label>æ­¥éª¤3: å…³è”ç§‘ç›®è¡¨æ¨¡æ¿</label><select><option>è‡ªåŠ¨åŒ¹é…æ¨¡æ¿</option><option>ä»ç°æœ‰æ¨¡æ¿é€‰æ‹©</option><option>ä¸Šä¼ æ–°æ¨¡æ¿</option></select></div>`;
                modalHtml += `<div class="form-group"><label>æ­¥éª¤4: (å¯é€‰) é…ç½®åˆå§‹ç‰¹å®šè§„åˆ™</label><textarea placeholder="e.g., å¯ç”¨æ–°åŠ å¡GSTç¨åŠ¡æ£€æŸ¥è§„åˆ™"></textarea></div>`;
                modalHtml += `<p style="font-size:0.9em; margin-top:15px;">åº•å±‚é‡‡ç”¨å¤šç§Ÿæˆ·æ¶æ„ï¼Œæ¯ä¸ªå•ä½çš„é…ç½®éš”ç¦»ç‹¬ç«‹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚</p>`;
                modalHtml += `<div class="finding-actions" style="margin-top:20px;"><button class="action-button-sim" onclick="alert('æ–°å•ä½å·²åˆå§‹åŒ– (æ¨¡æ‹Ÿ)'); closeModal();">å®Œæˆåˆå§‹åŒ–</button></div>`;
                openModal('æ–°å¢å•ä½å‘å¯¼ (æ¨¡æ‹Ÿ)', modalHtml);
            });
        }


        window.addEventListener('load', () => {
            document.body.style.opacity = '1';
            // Ensure the correct page is shown on load if a hash is present, or default to home
            const initialPage = window.location.hash ? window.location.hash.substring(1) : 'home';
            const validPages = ['home', 'data-input', 'budget-control', 'international-version'];
            if (validPages.includes(initialPage)) {
                showPage(initialPage);
            } else {
                showPage('home');
            }
        });
    </script>
</body>
</html>